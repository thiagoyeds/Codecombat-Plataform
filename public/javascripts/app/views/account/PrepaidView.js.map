{"version":3,"sources":["app/templates/account/prepaid-view.jade","app/views/account/PrepaidView.coffee"],"names":[],"mappings":"AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1LA;AAAA;;ACAA;EAAA;;;;AAAA,WAAW,QAAQ,qBAAR;;AACX,WAAW,QAAQ,gCAAR;;AACX,gBAAgB,QAAQ,sBAAR;;AACf,uBAAwB,QAAQ,kBAAR,EAAxB;;AACD,iBAAiB,QAAQ,4BAAR;;AACjB,UAAU,QAAQ,sBAAR;;AACV,QAAQ,QAAQ,YAAR;;AACR,cAAc,QAAQ,kCAAR;;AACd,QAAQ,QAAQ,YAAR;;AACR,WAAW,QAAQ,sBAAR;;AAIX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","file":"public/javascripts/app/views/account/PrepaidView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),features = locals_.features,me = locals_.me,view = locals_.view,usesSocialMedia = locals_.usesSocialMedia,isIE = locals_.isIE,fbRef = locals_.fbRef;buf.push(\"<div id=\\\"site-nav\\\"><a href=\\\"/\\\"><img id=\\\"nav-logo\\\" src=\\\"/images/pages/base/logo.png\\\" title=\\\"CodeCombat - Learn how to code by playing a game\\\" alt=\\\"CodeCombat\\\"/></a><div id=\\\"site-nav-links\\\"><a href=\\\"/\\\"><img id=\\\"small-nav-logo\\\" src=\\\"/images/pages/base/logo.png\\\" title=\\\"CodeCombat - Learn how to code by playing a game\\\" alt=\\\"CodeCombat\\\"/></a><a href=\\\"/\\\"><span class=\\\"glyphicon glyphicon-home\\\"></span></a>\");\nif ( !features.playViewsOnly)\n{\nbuf.push(\"<a href=\\\"/play\\\" data-i18n=\\\"common.play\\\"></a><a href=\\\"/play/ladder\\\" data-i18n=\\\"game_menu.multiplayer_tab\\\"></a>\");\nif ( me.isStudent())\n{\nbuf.push(\"<a href=\\\"/students\\\" data-i18n=\\\"nav.my_courses\\\"></a>\");\n}\nif ( me.isTeacher())\n{\nbuf.push(\"<a href=\\\"/teachers/classes\\\" data-i18n=\\\"nav.my_classrooms\\\"></a>\");\n}\nbuf.push(\"<a href=\\\"/about\\\" data-i18n=\\\"nav.about\\\"></a><a\" + (jade.attrs({ 'href':(view.forumLink()), 'data-i18n':(\"nav.forum\") }, {\"href\":true,\"data-i18n\":true})) + \"></a><a href=\\\"/community\\\" data-i18n=\\\"nav.community\\\"></a>\");\nif ( me.get('anonymous') === false)\n{\nbuf.push(\"<span class=\\\"dropdown\\\"><button href=\\\"#\\\" data-toggle=\\\"dropdown\\\" class=\\\"btn btn-sm header-font dropdown-toggle\\\">\");\nif ( me.get('photoURL'))\n{\nbuf.push(\"<img\" + (jade.attrs({ 'src':(me.getPhotoURL(18)), 'alt':(\"\"), \"class\": [('account-settings-image')] }, {\"src\":true,\"alt\":true})) + \"/>\");\n}\nelse\n{\nbuf.push(\"<i class=\\\"glyphicon glyphicon-user\\\"></i>\");\n}\nbuf.push(\"<span data-i18n=\\\"nav.account\\\" href=\\\"/account\\\" class=\\\"spl spr\\\"></span><span class=\\\"caret\\\"></span></button><ul role=\\\"menu\\\" class=\\\"dropdown-menu\\\"><li class=\\\"user-dropdown-header\\\"><span class=\\\"user-level\\\">\" + (jade.escape(null == (jade.interp = me.level()) ? \"\" : jade.interp)) + \"</span><a\" + (jade.attrs({ 'href':(\"/user/\" + (me.getSlugOrID()) + \"\") }, {\"href\":true})) + \"><div\" + (jade.attrs({ 'style':(\"background-image: url(\" + (me.getPhotoURL()) + \")\"), \"class\": [('img-circle')] }, {\"style\":true})) + \"></div></a><h3>\" + (jade.escape(null == (jade.interp = me.broadName()) ? \"\" : jade.interp)) + \"</h3></li><li><a\" + (jade.attrs({ 'href':(\"/user/\" + (me.getSlugOrID()) + \"\"), 'data-i18n':(\"nav.profile\") }, {\"href\":true,\"data-i18n\":true})) + \"></a></li><li><a href=\\\"/account/settings\\\" data-i18n=\\\"play.settings\\\"></a></li>\");\nif ( me.isAdmin() || !(me.isTeacher() || me.isStudent()))\n{\nbuf.push(\"<li><a href=\\\"/account/payments\\\" data-i18n=\\\"account.payments\\\"></a></li>\");\n}\nif ( me.isAdmin() || !(me.isTeacher() || me.isStudent()) || me.hasSubscription())\n{\nbuf.push(\"<li><a href=\\\"/account/subscription\\\" data-i18n=\\\"account.subscription\\\"></a></li>\");\n}\nif ( me.isAdmin() || !(me.isTeacher() || me.isStudent()))\n{\nbuf.push(\"<li><a href=\\\"/account/prepaid\\\" data-i18n=\\\"account.prepaid_codes\\\"></a></li>\");\n}\nbuf.push(\"<li><a id=\\\"logout-button\\\" data-i18n=\\\"login.log_out\\\"></a></li></ul></span>\");\n}\nelse\n{\nbuf.push(\"<button data-i18n=\\\"login.sign_up\\\" class=\\\"btn btn-sm btn-primary header-font signup-button\\\"></button><button data-i18n=\\\"login.log_in\\\" class=\\\"btn btn-sm btn-default header-font login-button\\\"></button>\");\n}\n}\nbuf.push(\"<select class=\\\"language-dropdown form-control\\\"></select></div></div><div id=\\\"site-content-area\\\">\");\nif ( me.get('anonymous'))\n{\nbuf.push(\"<p data-i18n=\\\"account_settings.not_logged_in\\\">Log in or create an account to change your settings.</p>\");\n}\nelse\n{\nbuf.push(\"<ol class=\\\"breadcrumb\\\"><li><a href=\\\"/\\\"><span class=\\\"glyphicon glyphicon-home\\\"></span></a></li><li><a href=\\\"/account\\\" data-i18n=\\\"nav.account\\\"></a></li><li data-i18n=\\\"account.prepaid_codes\\\" class=\\\"active\\\"></li></ol><div class=\\\"row\\\"><div class=\\\"col-md-12\\\"><div class=\\\"panel panel-default\\\"><div class=\\\"panel-heading\\\"><div class=\\\"panel-title\\\"><a data-toggle=\\\"collapse\\\" href=\\\"#purchasepanel\\\"><span data-i18n=\\\"account_prepaid.purchase_code\\\"></span></a></div></div><div\" + (jade.attrs({ 'id':('purchasepanel'), \"class\": [('panel-collapse'),('collapse'),(view.ppcQuery ? \"\": \"in\")] }, {\"class\":true})) + \"><div class=\\\"panel-body\\\"><p data-i18n=\\\"account_prepaid.purchase_code1\\\"></p><p data-i18n=\\\"account_prepaid.purchase_code2\\\"></p><p data-i18n=\\\"account_prepaid.purchase_code3\\\"></p><strong><p data-i18n=\\\"account_prepaid.purchase_code4\\\"></p><p><span data-i18n=\\\"account_prepaid.purchase_code5\\\" class=\\\"spl\\\"></span><span>: </span><a href=\\\"mailto:team@codecombat.com\\\">team@codecombat.com</a></p></strong><div class=\\\"form-horizontal\\\"><div class=\\\"form-group\\\"><label for=\\\"users\\\" data-i18n=\\\"account_prepaid.users\\\" class=\\\"control-label col-md-2\\\"></label><div class=\\\"col-md-2\\\"><input\" + (jade.attrs({ 'id':('users-input'), 'name':(\"users\"), 'type':(\"number\"), 'value':(\"\" + (view.purchase.users) + \"\"), 'min':(1), \"class\": [('form-control')] }, {\"name\":true,\"type\":true,\"value\":true,\"min\":true})) + \"/></div></div><div class=\\\"form-group\\\"><label for=\\\"months\\\" data-i18n=\\\"account_prepaid.months\\\" class=\\\"control-label col-md-2\\\"></label><div class=\\\"col-md-2\\\"><input\" + (jade.attrs({ 'id':('months-input'), 'name':(\"months\"), 'type':(\"number\"), 'value':(\"\" + (view.purchase.months) + \"\"), 'min':(1), \"class\": [('form-control')] }, {\"name\":true,\"type\":true,\"value\":true,\"min\":true})) + \"/></div></div><div class=\\\"form-group\\\"><label data-i18n=\\\"account_prepaid.purchase_total\\\" class=\\\"control-label col-md-2\\\"></label><div class=\\\"col-md-10\\\"><p class=\\\"form-control-static\\\">$<span id=\\\"total\\\">\" + (jade.escape((jade.interp = (view.purchase.total/100).toFixed(2)) == null ? '' : jade.interp)) + \"</span></p></div></div><button id=\\\"purchase-btn\\\" data-i18n=\\\"account_prepaid.purchase_button\\\" class=\\\"btn btn-success pull-right\\\"></button></div></div></div></div></div></div><div class=\\\"row\\\"><div class=\\\"col-md-12\\\"><div class=\\\"panel panel-default\\\"><div class=\\\"panel-heading\\\"><div class=\\\"panel-title\\\"><a data-toggle=\\\"collapse\\\" href=\\\"#redeempanel\\\"><span data-i18n=\\\"account_prepaid.redeem_codes\\\"></span></a></div></div><div id=\\\"redeempanel\\\" class=\\\"panel-collapse collapse in\\\"><div class=\\\"panel-body\\\"><p><span data-i18n=\\\"account_prepaid.prepaid_code\\\"></span><span class=\\\"spr\\\">:</span><input\" + (jade.attrs({ 'name':(\"ppc\"), 'type':(\"text\"), 'value':(\"\" + (view.ppc) + \"\"), 'required':(true), \"class\": [('input-ppc')] }, {\"name\":true,\"type\":true,\"value\":true,\"required\":false})) + \"/></p>\");\nif ( view.ppcInfo && view.ppcInfo.length > 0)\n{\nbuf.push(\"<p>\");\n// iterate view.ppcInfo\n;(function(){\n  var $$obj = view.ppcInfo;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var info = $$obj[$index];\n\nbuf.push(\"<div>\" + (null == (jade.interp = info) ? \"\" : jade.interp) + \"</div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var info = $$obj[$index];\n\nbuf.push(\"<div>\" + (null == (jade.interp = info) ? \"\" : jade.interp) + \"</div>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</p>\");\n}\nbuf.push(\"<p><span class=\\\"spr\\\"><button id=\\\"lookup-code-btn\\\" data-i18n=\\\"account_prepaid.lookup_code\\\" class=\\\"btn btn-info\\\"></button></span><span><button id=\\\"redeem-code-btn\\\" data-i18n=\\\"account_prepaid.apply_account\\\" class=\\\"btn btn-success\\\"></button></span></p></div></div></div></div></div><div class=\\\"row\\\"><div class=\\\"col-md-12\\\"><div id=\\\"codes-panel\\\" class=\\\"panel panel-default\\\"><div class=\\\"panel-heading\\\"><div class=\\\"panel-title\\\"><a data-toggle=\\\"collapse\\\" href=\\\"#codeslist\\\"><span data-i18n=\\\"account_prepaid.your_codes\\\"></span></a></div></div><div id=\\\"codeslist\\\" class=\\\"panel-collapse collapse in\\\"><div class=\\\"panel-body\\\">\");\nif ( view.codes && view.codes.length)\n{\nbuf.push(\"<table class=\\\"table table-striped\\\"><tr><th> <span data-i18n=\\\"[title]account_prepaid.copy_link;general.code\\\" title=\\\"You can copy the code's link and send it to someone.\\\" class=\\\"spr\\\"><span aria-hidden=\\\"true\\\" class=\\\"glyphicon glyphicon-question-sign\\\"></span></span></th><th data-i18n=\\\"account_prepaid.months\\\"></th><th>Remaining Users</th><th>Total Users</th><th data-i18n=\\\"user.status\\\"></th></tr>\");\n// iterate view.codes.models\n;(function(){\n  var $$obj = view.codes.models;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var code = $$obj[$index];\n\nif ( code.get('type') === 'terminal_subscription')\n{\nvar owner = (code.get('creator') == me.id ? true : false)\nvar properties = code.get('properties')\nvar redeemers = code.get('redeemers')\nvar redeemed = redeemers ? redeemers.length : 0\nbuf.push(\"<tr><td><a\" + (jade.attrs({ 'href':(\"/account/prepaid?_ppc=\" + (code.get('code')) + \"\") }, {\"href\":true})) + \">\" + (jade.escape(null == (jade.interp = code.get('code')) ? \"\" : jade.interp)) + \"</a></td><td>\" + (jade.escape(null == (jade.interp = properties.months || '-') ? \"\" : jade.interp)) + \"</td>\");\nif ( owner)\n{\nbuf.push(\"<td>\" + (jade.escape(null == (jade.interp = code.get('maxRedeemers') - redeemed) ? \"\" : jade.interp)) + \"</td><td>\" + (jade.escape(null == (jade.interp = code.get('maxRedeemers')) ? \"\" : jade.interp)) + \"</td><td data-i18n=\\\"account.purchased\\\"></td>\");\n}\nelse\n{\nbuf.push(\"<td>-</td><td>-</td><td data-i18n=\\\"account_prepaid.redeemed\\\"></td>\");\n}\nbuf.push(\"</tr>\");\n}\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var code = $$obj[$index];\n\nif ( code.get('type') === 'terminal_subscription')\n{\nvar owner = (code.get('creator') == me.id ? true : false)\nvar properties = code.get('properties')\nvar redeemers = code.get('redeemers')\nvar redeemed = redeemers ? redeemers.length : 0\nbuf.push(\"<tr><td><a\" + (jade.attrs({ 'href':(\"/account/prepaid?_ppc=\" + (code.get('code')) + \"\") }, {\"href\":true})) + \">\" + (jade.escape(null == (jade.interp = code.get('code')) ? \"\" : jade.interp)) + \"</a></td><td>\" + (jade.escape(null == (jade.interp = properties.months || '-') ? \"\" : jade.interp)) + \"</td>\");\nif ( owner)\n{\nbuf.push(\"<td>\" + (jade.escape(null == (jade.interp = code.get('maxRedeemers') - redeemed) ? \"\" : jade.interp)) + \"</td><td>\" + (jade.escape(null == (jade.interp = code.get('maxRedeemers')) ? \"\" : jade.interp)) + \"</td><td data-i18n=\\\"account.purchased\\\"></td>\");\n}\nelse\n{\nbuf.push(\"<td>-</td><td>-</td><td data-i18n=\\\"account_prepaid.redeemed\\\"></td>\");\n}\nbuf.push(\"</tr>\");\n}\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</table>\");\n}\nelse\n{\nbuf.push(\"<p data-i18n=\\\"account_prepaid.no_codes\\\"></p>\");\n}\nbuf.push(\"</div></div></div></div></div>\");\n}\nbuf.push(\"</div><div class=\\\"achievement-corner\\\"></div><div id=\\\"site-footer\\\"><img id=\\\"footer-background\\\" src=\\\"/images/pages/base/nav_background.png\\\"/><div\" + (jade.attrs({ 'id':('footer-links'), \"class\": [(features.playViewsOnly ? 'hide' : '')] }, {\"class\":true})) + \"><a href=\\\"/about\\\" data-i18n=\\\"nav.about\\\"></a>\");\nif ( !me.isStudent())\n{\nbuf.push(\"<a tabindex=\\\"-1\\\" data-i18n=\\\"nav.contact\\\" class=\\\"contact-modal\\\"></a>\");\n}\nbuf.push(\"<a href=\\\"http://blog.codecombat.com/\\\" data-i18n=\\\"nav.blog\\\"></a><a href=\\\"https://jobs.lever.co/codecombat\\\" tabindex=\\\"-1\\\" data-i18n=\\\"nav.careers\\\"></a><a href=\\\"/legal\\\" tabindex=\\\"-1\\\" data-i18n=\\\"nav.legal\\\"></a><a href=\\\"/privacy\\\" tabindex=\\\"-1\\\" data-i18n=\\\"legal.privacy_title\\\"></a><a href=\\\"/contribute\\\" tabindex=\\\"-1\\\" data-i18n=\\\"nav.contribute\\\"></a>\");\nif ( !me.isStudent())\n{\nbuf.push(\"<a href=\\\"/play/ladder\\\" tabindex=\\\"-1\\\" data-i18n=\\\"game_menu.multiplayer_tab\\\"></a>\");\n}\nif ( me.isAdmin())\n{\nbuf.push(\"<a href=\\\"/admin\\\">Admin</a>\");\n}\nif ( usesSocialMedia)\n{\nbuf.push(\"<div class=\\\"share-buttons\\\">\");\nif ( !isIE)\n{\nbuf.push(\"<div data-href=\\\"http://codecombat.com\\\" data-size=\\\"medium\\\" class=\\\"g-plusone\\\"></div>\");\n}\nbuf.push(\"<div\" + (jade.attrs({ 'data-href':(\"https://www.facebook.com/codecombat\"), 'data-send':(\"false\"), 'data-layout':(\"button_count\"), 'data-width':(\"350\"), 'data-show-faces':(\"true\"), 'data-ref':(\"coco_footer_\" + (fbRef) + \"\"), \"class\": [('fb-like')] }, {\"data-href\":true,\"data-send\":true,\"data-layout\":true,\"data-width\":true,\"data-show-faces\":true,\"data-ref\":true})) + \"></div>\");\nif ( !isIE)\n{\nbuf.push(\"<a href=\\\"https://twitter.com/CodeCombat\\\" data-show-count=\\\"true\\\" data-show-screen-name=\\\"false\\\" data-dnt=\\\"true\\\" data-align=\\\"right\\\" data-i18n=\\\"nav.twitter_follow\\\" class=\\\"twitter-follow-button\\\"></a><iframe src=\\\"https://ghbtns.com/github-btn.html?user=codecombat&amp;repo=codecombat&amp;type=watch&amp;count=true\\\" allowtransparency=\\\"true\\\" frameborder=\\\"0\\\" scrolling=\\\"0\\\" width=\\\"110\\\" height=\\\"20\\\" class=\\\"github-star-button\\\"></iframe>\");\n}\nbuf.push(\"</div>\");\n}\nbuf.push(\"</div><div id=\\\"footer-credits\\\"><span><span>Â© All Rights Reserved</span><br/><span>CodeCombat 2015</span></span><img id=\\\"footer-logo\\\" src=\\\"/images/pages/base/logo.png\\\" alt=\\\"CodeCombat\\\"/><span><span>Site Design by</span><br/><a href=\\\"http://www.fullyillustrated.com/\\\">Fully Illustrated</a></span><!--a.firebase-bade(href=\\\"https://www.firebase.com/\\\")  // Not using right now--><!--  img(src=\\\"/images/pages/base/firebase.png\\\", alt=\\\"Powered by Firebase\\\")--></div></div>\");;return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","RootView = require 'views/core/RootView'\r\ntemplate = require 'templates/account/prepaid-view'\r\nstripeHandler = require 'core/services/stripe'\r\n{getPrepaidCodeAmount} = require '../../core/utils'\r\nCocoCollection = require 'collections/CocoCollection'\r\nPrepaid = require '../../models/Prepaid'\r\nutils = require 'core/utils'\r\nRedeemModal = require 'views/account/PrepaidRedeemModal'\r\nforms = require 'core/forms'\r\nProducts = require 'collections/Products'\r\n\r\n# TODO: remove redeem code modal\r\n\r\nmodule.exports = class PrepaidView extends RootView\r\n  id: 'prepaid-view'\r\n  template: template\r\n  className: 'container-fluid'\r\n\r\n  events:\r\n    'change #users-input': 'onChangeUsersInput'\r\n    'change #months-input': 'onChangeMonthsInput'\r\n    'click #purchase-btn': 'onClickPurchaseButton'\r\n    'click #redeem-btn': 'onClickRedeemButton' # DNE?\r\n    'click #lookup-code-btn': 'onClickLookupCodeButton'\r\n    'click #redeem-code-btn': 'onClickRedeemCodeButton'\r\n\r\n  subscriptions:\r\n    'stripe:received-token': 'onStripeReceivedToken'\r\n\r\n  initialize: ->\r\n    @purchase =\r\n      total: 0\r\n      users: 3\r\n      months: 3\r\n    @updateTotal()\r\n\r\n    @codes = new CocoCollection([], { url: '/db/user/'+me.id+'/prepaid_codes', model: Prepaid })\r\n    @codes.on 'sync', (code) => @render?()\r\n    @supermodel.loadCollection(@codes, {cache: false})\r\n\r\n    @ppc = utils.getQueryVariable('_ppc') ? ''\r\n    unless _.isEmpty(@ppc)\r\n      @ppcQuery = true\r\n      @loadPrepaid(@ppc)\r\n\r\n    @products = new Products()\r\n    @supermodel.loadCollection(@products)\r\n    \r\n  onLoaded: ->\r\n    @prepaidProduct = @products.findWhere { name: 'prepaid_subscription' }\r\n    @updateTotal()\r\n    super()\r\n\r\n  afterRender: ->\r\n    super()\r\n    @$el.find(\"span[title]\").tooltip()\r\n\r\n  statusMessage: (message, type='alert') ->\r\n    noty text: message, layout: 'topCenter', type: type, killer: false, timeout: 5000, dismissQueue: true, maxVisible: 3\r\n\r\n  updateTotal: ->\r\n    return unless @prepaidProduct\r\n    @purchase.total = getPrepaidCodeAmount(@prepaidProduct.get('amount'), @purchase.users, @purchase.months)\r\n    @renderSelectors(\"#total\", \"#users-input\", \"#months-input\")\r\n\r\n  # Form Input Callbacks\r\n  onChangeUsersInput: (e) ->\r\n    newAmount = $(e.target).val()\r\n    newAmount = 1 if newAmount < 1\r\n    @purchase.users = newAmount\r\n    el = $('#purchasepanel')\r\n    if newAmount < 3 and @purchase.months < 3\r\n      message = \"Either Users or Months must be greater than 2\"\r\n      err = [message: message, property: 'users', formatted: true]\r\n      forms.clearFormAlerts(el)\r\n      forms.applyErrorsToForm(el, err)\r\n    else\r\n      forms.clearFormAlerts(el)\r\n\r\n    @updateTotal()\r\n\r\n  onChangeMonthsInput: (e) ->\r\n    newAmount = $(e.target).val()\r\n    newAmount = 1 if newAmount < 1\r\n    @purchase.months = newAmount\r\n    el = $('#purchasepanel')\r\n    if newAmount < 3 and @purchase.users < 3\r\n      message = \"Either Users or Months must be greater than 2\"\r\n      err = [message: message, property: 'months', formatted: true]\r\n      forms.clearFormAlerts(el)\r\n      forms.applyErrorsToForm(el, err)\r\n    else\r\n      forms.clearFormAlerts(el)\r\n\r\n    @updateTotal()\r\n\r\n  onClickPurchaseButton: (e) ->\r\n    return unless $(\"#users-input\").val() >= 3 or $(\"#months-input\").val() >= 3\r\n    @purchaseTimestamp = new Date().getTime()\r\n    @stripeAmount = @purchase.total\r\n    @description = \"Prepaid Code for \" + @purchase.users + \" users / \" + @purchase.months + \" months\"\r\n\r\n    stripeHandler.open\r\n      amount: @stripeAmount\r\n      description: @description\r\n      bitcoin: true\r\n      alipay: if me.get('country') is 'china' or (me.get('preferredLanguage') or 'en-US')[...2] is 'zh' then true else 'auto'\r\n\r\n  onClickRedeemButton: (e) ->\r\n    @ppc = $('#ppc').val()\r\n\r\n    unless @ppc\r\n      @statusMessage \"You must enter a code.\", \"error\"\r\n      return\r\n    options =\r\n      url: '/db/prepaid/-/code/'+ @ppc\r\n      method: 'GET'\r\n\r\n    options.success = (model, res, options) =>\r\n      redeemModal = new RedeemModal ppc: model\r\n      redeemModal.on 'confirm-redeem', @confirmRedeem\r\n      @openModalView redeemModal\r\n\r\n    options.error = (model, res, options) =>\r\n      console.warn 'Error getting Prepaid Code'\r\n\r\n    prepaid = new Prepaid()\r\n    prepaid.fetch(options)\r\n    # @supermodel.addRequestResource('get_prepaid', options, 0).load()\r\n\r\n\r\n  confirmRedeem: =>\r\n\r\n    options =\r\n      url: '/db/subscription/-/subscribe_prepaid'\r\n      method: 'POST'\r\n      data: { ppc: @ppc }\r\n\r\n    options.error = (model, res, options, foo) =>\r\n      # console.error 'FAILED redeeming prepaid code'\r\n      msg = model.responseText ? ''\r\n      @statusMessage \"Error: Could not redeem prepaid code. #{msg}\", \"error\"\r\n\r\n    options.success = (model, res, options) =>\r\n      # console.log 'SUCCESS redeeming prepaid code'\r\n      @statusMessage \"Prepaid Code Redeemed!\", \"success\"\r\n      @supermodel.loadCollection(@codes, 'prepaid', {cache: false})\r\n      @codes.fetch()\r\n      me.fetch cache: false\r\n\r\n    @supermodel.addRequestResource('subscribe_prepaid', options, 0).load()\r\n\r\n\r\n  onStripeReceivedToken: (e) ->\r\n    # TODO: show that something is happening in the UI\r\n    options =\r\n      url: '/db/prepaid/-/purchase'\r\n      method: 'POST'\r\n\r\n    options.data =\r\n      amount: @stripeAmount\r\n      description: @description\r\n      stripe:\r\n        token: e.token.id\r\n        timestamp: @purchaseTimestamp\r\n      type: 'terminal_subscription'\r\n      maxRedeemers: @purchase.users\r\n      months: @purchase.months\r\n\r\n    options.error = (model, response, options) =>\r\n      console.error 'FAILED: Prepaid purchase', response\r\n      console.error options\r\n      @statusMessage \"Error purchasing prepaid code\", \"error\"\r\n      # Not sure when this will happen. Stripe popup seems to give appropriate error messages.\r\n\r\n    options.success = (model, response, options) =>\r\n      # console.log 'SUCCESS: Prepaid purchase', model.code\r\n      @statusMessage \"Successfully purchased Prepaid Code!\", \"success\"\r\n      @codes.add(model)\r\n      @renderSelectors('#codes-panel')\r\n\r\n    @statusMessage \"Finalizing purchase...\", \"information\"\r\n    @supermodel.addRequestResource(options, 0).load()\r\n\r\n  loadPrepaid: (ppc) ->\r\n    return unless ppc\r\n    options =\r\n      cache: false\r\n      method: 'GET'\r\n      url: \"/db/prepaid/-/code/#{ppc}\"\r\n\r\n    options.success = (model, res, options) =>\r\n      @ppcInfo = []\r\n      if model.get('type') is 'terminal_subscription'\r\n        months = model.get('properties')?.months ? 0\r\n        maxRedeemers = model.get('maxRedeemers') ? 0\r\n        redeemers = model.get('redeemers') ? []\r\n        unlocksLeft = maxRedeemers - redeemers.length\r\n        @ppcInfo.push \"This prepaid code adds <strong>#{months} months of subscription</strong> to your account.\"\r\n        @ppcInfo.push \"It can be used <strong>#{unlocksLeft} more</strong> times.\"\r\n        # TODO: user needs to know they can't apply it more than once to their account\r\n      else\r\n        @ppcInfo.push \"Type: #{model.get('type')}\"\r\n      @render?()\r\n    options.error = (model, res, options) =>\r\n      @statusMessage \"Unable to retrieve code.\", \"error\"\r\n\r\n    @prepaid = new Prepaid()\r\n    @prepaid.fetch(options)\r\n\r\n  onClickLookupCodeButton: (e) ->\r\n    @ppc = $('.input-ppc').val()\r\n    unless @ppc\r\n      @statusMessage \"You must enter a code.\", \"error\"\r\n      return\r\n    @ppcInfo = []\r\n    @render?()\r\n    @loadPrepaid(@ppc)\r\n\r\n  onClickRedeemCodeButton: (e) ->\r\n    @ppc = $('.input-ppc').val()\r\n    options =\r\n      url: '/db/subscription/-/subscribe_prepaid'\r\n      method: 'POST'\r\n      data: { ppc: @ppc }\r\n    options.error = (model, res, options, foo) =>\r\n      msg = model.responseText ? ''\r\n      @statusMessage \"Error: Could not redeem prepaid code. #{msg}\", \"error\"\r\n    options.success = (model, res, options) =>\r\n      @statusMessage \"Prepaid applied to your account!\", \"success\"\r\n      @codes.fetch cache: false\r\n      me.fetch cache: false\r\n      @loadPrepaid(@ppc)\r\n    @supermodel.addRequestResource('subscribe_prepaid', options, 0).load()\r\n"]}