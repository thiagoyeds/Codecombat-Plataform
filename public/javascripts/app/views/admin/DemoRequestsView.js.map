{"version":3,"sources":["app/views/admin/DemoRequestsView.coffee"],"names":[],"mappings":";AAAA;EAAA;;;AAAA,WAAW,QAAQ,qBAAR;;AACX,WAAW,QAAQ,+BAAR;;AACX,iBAAiB,QAAQ,4BAAR;;AACjB,eAAe,QAAQ,qBAAR;;AAEf,MAAM,CAAC,OAAP,GAAuB;;;6BACrB,KAAI;;6BACJ,WAAU;;EAEG,0BAAC,OAAD;IACX,kDAAM,OAAN;IACA,KAAc,EAAE,CAAC,OAAH,EAAd;AAAA;;IACA,IAAC,cAAD,GAAqB,mBAAe,EAAf,EAAmB;MAAE,KAAK,sEAAP;MAA+E,OAAO,YAAtF;KAAnB;IACrB,IAAC,WAAU,CAAC,cAAZ,CAA2B,IAAC,cAA5B,EAA2C,gBAA3C,EAA6D;MAAC,OAAO,KAAR;KAA7D;IACA,IAAC,UAAD,GAAa;EALF;;6BAOb,WAAU;AACR;IAAA,KAAsB,EAAE,CAAC,OAAH,EAAtB;AAAA,aAAO,+CAAP;;IACA,cAAc;AACd;AAAA;;MACE,MAAM,YAAY,CAAC,GAAb,CAAiB,SAAjB,CAA2B,CAAC,SAA5B,CAAsC,CAAtC,EAAyC,EAAzC;;QACN,WAAY,QAAQ;;MACpB,WAAY,KAAZ;AAHF;IAIA,IAAC,UAAD,GAAa;AACb;;MACE,IAAC,UAAS,CAAC,IAAX,CAAgB;QAAA,KAAK,GAAL;QAAU,OAAO,KAAjB;OAAhB;AADF;IAEA,IAAC,UAAS,CAAC,IAAX,CAAgB,SAAC,CAAD,EAAI,CAAJ;aAAU,CAAC,CAAC,GAAG,CAAC,aAAN,CAAoB,CAAC,CAAC,GAAtB;IAAV,CAAhB;IACA,cAAc;AACd,SAAS,gGAAT;MACE,WAAW,IAAC,UAAU;MACtB,WAAW,CAAC,IAAZ,CAAiB,QAAQ,CAAC,KAA1B;AACA,aAAM,WAAW,CAAC,MAAZ,GAAqB,CAA3B;QACE,WAAW,CAAC,KAAZ;MADF;MAEA,IAAG,WAAW,CAAC,MAAZ,KAAsB,CAAzB;QACE,QAAQ,CAAC,YAAT,GAAwB,IAAI,CAAC,KAAL,CAAW,WAAW,CAAC,MAAZ,CAAmB,CAAC,SAAC,CAAD,EAAI,CAAJ;iBAAU,IAAI;QAAd,CAAD,CAAnB,EAAsC,CAAtC,IAA2C,CAAtD,EAD1B;;AALF;WAOA;EAnBQ;;;;GAXoC","file":"public/javascripts/app/views/admin/DemoRequestsView.js","sourcesContent":["RootView = require 'views/core/RootView'\ntemplate = require 'templates/admin/demo-requests'\nCocoCollection = require 'collections/CocoCollection'\nTrialRequest = require 'models/TrialRequest'\n\nmodule.exports = class DemoRequestsView extends RootView\n  id: 'admin-demo-requests-view'\n  template: template\n\n  constructor: (options) ->\n    super options\n    return unless me.isAdmin()\n    @trialRequests = new CocoCollection([], { url: '/db/trial.request?conditions[sort]=\"-created\"&conditions[limit]=5000', model: TrialRequest })\n    @supermodel.loadCollection(@trialRequests, 'trial-requests', {cache: false})\n    @dayCounts = []\n\n  onLoaded: ->\n    return super() unless me.isAdmin()\n    dayCountMap = {}\n    for trialRequest in @trialRequests.models\n      day = trialRequest.get('created').substring(0, 10)\n      dayCountMap[day] ?= 0\n      dayCountMap[day]++\n    @dayCounts = []\n    for day, count of dayCountMap\n      @dayCounts.push(day: day, count: count)\n    @dayCounts.sort((a, b) -> b.day.localeCompare(a.day))\n    sevenCounts = []\n    for i in [@dayCounts.length - 1..0]\n      dayCount = @dayCounts[i]\n      sevenCounts.push(dayCount.count)\n      while sevenCounts.length > 7\n        sevenCounts.shift()\n      if sevenCounts.length is 7\n        dayCount.sevenAverage = Math.round(sevenCounts.reduce(((a, b) -> a + b), 0) / 7)\n    super()\n"]}