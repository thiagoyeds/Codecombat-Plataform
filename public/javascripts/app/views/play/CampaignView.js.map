{"version":3,"sources":["app/templates/play/campaign-view.jade","app/views/play/CampaignView.coffee"],"names":[],"mappings":"AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjnBA;AAAA;;ACAA;EAAA;;;;;AAAA,WAAW,QAAQ,qBAAR;;AACX,WAAW,QAAQ,8BAAR;;AACX,eAAe,QAAQ,qBAAR;;AACf,oBAAoB,QAAQ,0BAAR;;AACpB,iBAAiB,QAAQ,4BAAR;;AACjB,WAAW,QAAQ,iBAAR;;AACX,cAAc,QAAQ,iBAAR;;AACd,oBAAoB,QAAQ,uBAAR;;AACpB,YAAY,QAAQ,kBAAR;;AACZ,cAAc,QAAQ,yBAAR;;AACd,UAAU,QAAQ,cAAR;;AACV,qBAAqB,QAAQ,+BAAR;;AACrB,iBAAiB,QAAQ,2BAAR;;AACjB,mBAAmB,QAAQ,mCAAR;;AACnB,QAAQ,QAAQ,cAAR;;AACR,QAAQ,QAAQ,YAAR;;AACR,QAAQ,cAAR;;AACA,cAAc,QAAQ,kBAAR;;AACd,qBAAqB,QAAQ,qCAAR;;AACrB,kBA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","file":"public/javascripts/app/views/play/CampaignView.js","sourcesContent":["var __templateData = function anonymous(locals\n/**/) {\nvar buf = [];\nvar locals_ = (locals || {}),view = locals_.view,campaign = locals_.campaign,features = locals_.features,serverConfig = locals_.serverConfig,levels = locals_.levels,i18n = locals_.i18n,translate = locals_.translate,levelStatusMap = locals_.levelStatusMap,editorMode = locals_.editorMode,levelDifficultyMap = locals_.levelDifficultyMap,levelPlayCountMap = locals_.levelPlayCountMap,marked = locals_.marked,picoCTF = locals_.picoCTF,me = locals_.me,adjacentCampaigns = locals_.adjacentCampaigns,_ = locals_._,campaigns = locals_.campaigns,levelsCompleted = locals_.levelsCompleted,levelsTotal = locals_.levelsTotal;if ( view.showAds())\n{\nbuf.push(\"<!-- TODO: loading this multiple times yields script error:--><!-- Uncaught TagError: adsbygoogle.push() error: All ins elements in the DOM with class=adsbygoogle already have ads in them.--><div class=\\\"ad-container\\\">\");\nif ( campaign)\n{\nbuf.push(\"<script async=\\\"async\\\" src=\\\"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\\\"></script><ins style=\\\"display:inline-block;width:728px;height:90px\\\" data-ad-client=\\\"ca-pub-6640930638193614\\\" data-ad-slot=\\\"4924994487\\\" class=\\\"adsbygoogle\\\"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>\");\n}\nelse\n{\nbuf.push(\"<script async=\\\"async\\\" src=\\\"//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js\\\"></script><ins style=\\\"display:inline-block;width:728px;height:90px\\\" data-ad-client=\\\"ca-pub-6640930638193614\\\" data-ad-slot=\\\"4469166082\\\" class=\\\"adsbygoogle\\\"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});\\n</script>\");\n}\nbuf.push(\"</div>\");\n}\nbuf.push(\"<!-- TODO: .gameplay-container causes world map buttons to briefly appear in top left of screen--><div class=\\\"gameplay-container\\\">\");\nif ( features.codePlay)\n{\nbuf.push(\"<img src=\\\"/images/common/codeplay/CodePlay_Lockup.png\\\" class=\\\"small-nav-logo codeplay-logo\\\"/>\");\n}\nelse\n{\nbuf.push(\"<a href=\\\"/\\\" class=\\\"picoctf-hide\\\"><img src=\\\"/images/pages/base/logo.png\\\" title=\\\"CodeCombat - Learn how to code by playing a game\\\" alt=\\\"CodeCombat\\\" class=\\\"small-nav-logo\\\"/></a><div class=\\\"picoctf-show\\\"><a href=\\\"http://staging.picoctf.com\\\" class=\\\"picoctf-logo\\\"><img src=\\\"/images/pages/play/picoctf-logo-white.png\\\" title=\\\"picoCTF home\\\" alt=\\\"picoCTF home\\\" class=\\\"small-nav-logo\\\"/></a><a href=\\\"http://codecombat.com\\\" class=\\\"picoctf-powered-by\\\"><em class=\\\"spr\\\">powered by</em><img src=\\\"/images/pages/base/logo.png\\\" title=\\\"Powered by CodeCombat - Learn how to code by playing a game \\\" alt=\\\"Powered by CodeCombat\\\"/></a></div>\");\n}\nif ( serverConfig.codeNinjas)\n{\nbuf.push(\"<a href=\\\"https://code.ninja\\\"><img src=\\\"/images/pages/base/code-ninjas-logo-right.png\\\" title=\\\"Code Ninjas home\\\" alt=\\\"Code Ninjas home\\\" class=\\\"small-nav-logo code-ninjas-logo\\\"/></a>\");\n}\nif ( campaign)\n{\nbuf.push(\"<div class=\\\"map\\\"><div class=\\\"gradient horizontal-gradient top-gradient\\\"></div><div class=\\\"gradient vertical-gradient right-gradient\\\"></div><div class=\\\"gradient horizontal-gradient bottom-gradient\\\"></div><div class=\\\"gradient vertical-gradient left-gradient\\\"></div><div alt=\\\"\\\" draggable=\\\"false\\\" class=\\\"map-background\\\"></div>\");\n// iterate levels\n;(function(){\n  var $$obj = levels;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var level = $$obj[$index];\n\nif ((campaign.levelIsPractice(level) || !level.unlockedInSameCampaign) && level.hidden)\n{\ncontinue;\n}\nbuf.push(\"<div\" + (jade.attrs({ 'style':(\"left: \" + (level.position.x) + \"%; bottom: \" + (level.position.y) + \"%; background-color: \" + (level.color) + \"\"), 'data-level-slug':(level.slug), 'data-level-original':(level.original), 'title':(i18n(level, 'name') + (level.disabled ? \" (\" + translate('common.coming_soon') + \")\" : '')), \"class\": [(\"level\" + (level.next ? \" next\" : \"\") + (level.disabled ? \" disabled\" : \"\") + (level.locked ? \" locked\" : \"\") + \" \" + (levelStatusMap[level.slug] || \"\"))] }, {\"style\":true,\"class\":true,\"data-level-slug\":true,\"data-level-original\":true,\"title\":true})) + \">\");\nif ( level.unlocksHero && (!level.purchasedHero || editorMode) && (level.hidden || levelStatusMap[level.slug] === 'complete'))\n{\nbuf.push(\"<img\" + (jade.attrs({ 'src':(\"/file/db/thang.type/\" + (level.unlocksHero) + \"/portrait.png\"), \"class\": [('hero-portrait')] }, {\"src\":true})) + \"/>\");\n}\nbuf.push(\"<a\" + (jade.attrs({ 'href':(level.type == 'hero' ? '#' : level.disabled ? \"/play\" : \"/play/\" + (level.levelPath || 'level') + \"/\" + (level.slug) + \"\"), 'disabled':(level.disabled), 'data-level-slug':(level.slug), 'data-level-path':(level.levelPath || 'level'), 'data-level-name':(level.name) }, {\"href\":true,\"disabled\":true,\"data-level-slug\":true,\"data-level-path\":true,\"data-level-name\":true})) + \"></a>\");\nif ( levelStatusMap[level.slug] === 'complete')\n{\nbuf.push(\"<img src=\\\"/images/pages/play/star.png\\\" class=\\\"star\\\"/>\");\n}\nif ( editorMode)\n{\nvar kindKey = ((level.kind && level.kind[0]) || \"\").toUpperCase();\nbuf.push(\"<!--if kindKey--><div\" + (jade.attrs({ \"class\": [(\"level-kind \" + level.kind)] }, {\"class\":true})) + \">\" + (jade.escape(null == (jade.interp = kindKey) ? \"\" : jade.interp)) + \"</div>\");\nvar acronym = level.name.replace(/(A |The )/g, '').replace(/[^A-Z]/g, '');\nbuf.push(\"<div class=\\\"level-acronym\\\">\" + (jade.escape(null == (jade.interp = acronym) ? \"\" : jade.interp)) + \"</div>\");\n}\nif ( !level.hidden)\n{\nif ( level.replayable)\n{\nbuf.push(\"<img src=\\\"/images/pages/play/level-banner-replayable.png\\\" class=\\\"banner\\\"/>\");\n}\nelse if ( level.type === 'hero-ladder' || level.type === 'course-ladder')\n{\nbuf.push(\"<img src=\\\"/images/pages/play/level-banner-multiplayer.png\\\" class=\\\"banner\\\"/>\");\n}\nelse if ( ['kithgard-gates', 'siege-of-stonehold', 'clash-of-clones', 'summits-gate', 'kithgard-mastery'].indexOf(level.slug) !== -1 && levelStatusMap[level.slug] !== 'complete')\n{\nbuf.push(\"<img src=\\\"/images/pages/play/level-banner-special.png\\\" class=\\\"banner\\\"/>\");\n}\nelse if ( level.unlocksHero && levelStatusMap[level.slug] !== 'complete')\n{\nbuf.push(\"<img src=\\\"/images/pages/play/level-banner-unlock.png\\\" class=\\\"banner\\\"/><img\" + (jade.attrs({ 'src':(\"/file/db/thang.type/\" + (level.unlocksHero) + \"/portrait.png\"), \"class\": [('hero-portrait'),('hero-portrait-on-banner')] }, {\"src\":true})) + \"/>\");\n}\nelse if ( level.unlocksItem && levelStatusMap[level.slug] !== 'complete')\n{\nbuf.push(\"<img src=\\\"/images/pages/play/level-banner-unlock.png\\\" class=\\\"banner\\\"/><img\" + (jade.attrs({ 'src':(\"/file/db/thang.type/\" + (level.unlocksItem) + \"/portrait.png\"), \"class\": [('item-portrait'),('item-portrait-on-banner')] }, {\"src\":true})) + \"/>\");\n}\nelse if ( levelStatusMap[level.slug] === 'started')\n{\nbuf.push(\"<img src=\\\"/images/pages/play/level-banner-started.png\\\" class=\\\"banner\\\"/>\");\n}\nelse if ( levelStatusMap[level.slug] !== 'complete')\n{\nbuf.push(\"<img src=\\\"/images/pages/play/level-banner-unstarted.png\\\" class=\\\"banner\\\"/>\");\n}\nif ( levelDifficultyMap[level.slug])\n{\nbuf.push(\"<div class=\\\"level-difficulty-banner-text\\\">\" + (jade.escape(null == (jade.interp = levelDifficultyMap[level.slug]) ? \"\" : jade.interp)) + \"</div>\");\n}\n}\nbuf.push(\"</div><div\" + (jade.attrs({ 'style':(\"left: \" + (level.position.x) + \"%; bottom: \" + (level.position.y) + \"%\"), \"class\": [(\"level-shadow\" + (level.next ? \" next\" : \"\") + (level.locked ? \" locked\" : \"\") + \" \" + (levelStatusMap[level.slug] || \"\"))] }, {\"style\":true,\"class\":true})) + \"></div><div\" + (jade.attrs({ 'data-level-slug':(level.slug), 'data-level-path':(level.levelPath || 'level'), 'data-level-name':(level.name), \"class\": [('level-info-container')] }, {\"data-level-slug\":true,\"data-level-path\":true,\"data-level-name\":true})) + \">\");\nvar playCount = levelPlayCountMap[level.slug]\nbuf.push(\"<div class=\\\"progress progress-striped active hide\\\"><div style=\\\"width: 100%\\\" class=\\\"progress-bar\\\"></div></div>\");\nvar showsLeaderboard = levelStatusMap[level.slug] === 'complete' && ((level.scoreTypes && level.scoreTypes.length) || ['hero-ladder', 'course-ladder'].indexOf(level.type) !== -1);\nbuf.push(\"<div\" + (jade.attrs({ \"class\": [(\"level-info \" + (levelStatusMap[level.slug] || \"\") + (level.requiresSubscription ? \" premium\" : \"\") + (showsLeaderboard ? \" shows-leaderboard\" : \"\"))] }, {\"class\":true})) + \"><div class=\\\"level-status\\\"></div><h3>\" + (jade.escape(null == (jade.interp = i18n(level, 'name') + (level.disabled ? \" (\" + translate('common.coming_soon') + \")\" : (level.locked ? \" (\" + translate('play.locked') + \")\" : \"\"))) ? \"\" : jade.interp)) + \"</h3>\");\nvar description = i18n(level, 'description') || level.description || \"\"\nbuf.push(\"<div class=\\\"level-description\\\">\" + (null == (jade.interp = marked(description, {sanitize: !picoCTF})) ? \"\" : jade.interp) + \"</div>\");\nif ( level.disabled)\n{\nbuf.push(\"<p><span data-i18n=\\\"play.awaiting_levels_adventurer_prefix\\\" class=\\\"spr\\\">We release five levels per week.</span><a href=\\\"/contribute/adventurer\\\" class=\\\"spr\\\"><strong data-i18n=\\\"play.awaiting_levels_adventurer\\\">Sign up as an Adventurer</strong></a><span data-i18n=\\\"play.awaiting_levels_adventurer_suffix\\\" class=\\\"spl\\\">to be the first to play new levels.</span></p>\");\n}\nif ( level.displayConcepts && level.displayConcepts.length)\n{\nbuf.push(\"<p>\");\n// iterate level.displayConcepts\n;(function(){\n  var $$obj = level.displayConcepts;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var concept = $$obj[$index];\n\nbuf.push(\"<kbd\" + (jade.attrs({ 'data-i18n':(\"concepts.\" + concept) }, {\"data-i18n\":true})) + \"></kbd>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var concept = $$obj[$index];\n\nbuf.push(\"<kbd\" + (jade.attrs({ 'data-i18n':(\"concepts.\" + concept) }, {\"data-i18n\":true})) + \"></kbd>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</p>\");\n}\nif ( !level.disabled && !level.locked)\n{\nif ( playCount && playCount.sessions)\n{\nbuf.push(\"<div class=\\\"play-counts hidden\\\"><span class=\\\"spl spr\\\">\" + (jade.escape(null == (jade.interp = playCount.sessions) ? \"\" : jade.interp)) + \"</span><span data-i18n=\\\"play.players\\\">players</span><span class=\\\"spr\\\">, \" + (jade.escape((jade.interp = Math.round(playCount.playtime / 3600)) == null ? '' : jade.interp)) + \"</span><span data-i18n=\\\"play.hours_played\\\">hours played</span></div>\");\n}\nif ( showsLeaderboard)\n{\nbuf.push(\"<button\" + (jade.attrs({ 'data-level-slug':(level.slug), \"class\": [('btn'),('btn-warning'),('btn'),('btn-lg'),('btn-illustrated'),('view-solutions')] }, {\"data-level-slug\":true})) + \"><span data-i18n=\\\"leaderboard.scores\\\"></span></button>\");\n}\nbuf.push(\"<button data-i18n=\\\"common.play\\\" class=\\\"btn btn-success btn btn-lg btn-illustrated start-level\\\">Play</button>\");\nif ( me.get('courseInstances') && me.get('courseInstances').length)\n{\nbuf.push(\"<div\" + (jade.attrs({ 'data-level-original':(level.original), \"class\": [('course-version'),('hidden')] }, {\"data-level-original\":true})) + \"><em data-i18n=\\\"general.or\\\"></em>...<br/><button class=\\\"btn btn-primary btn btn-lg btn-illustrated\\\"><span data-i18n=\\\"play.play_classroom_version\\\">Play Classroom Version</span></button></div>\");\n}\n}\nbuf.push(\"</div></div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var level = $$obj[$index];\n\nif ((campaign.levelIsPractice(level) || !level.unlockedInSameCampaign) && level.hidden)\n{\ncontinue;\n}\nbuf.push(\"<div\" + (jade.attrs({ 'style':(\"left: \" + (level.position.x) + \"%; bottom: \" + (level.position.y) + \"%; background-color: \" + (level.color) + \"\"), 'data-level-slug':(level.slug), 'data-level-original':(level.original), 'title':(i18n(level, 'name') + (level.disabled ? \" (\" + translate('common.coming_soon') + \")\" : '')), \"class\": [(\"level\" + (level.next ? \" next\" : \"\") + (level.disabled ? \" disabled\" : \"\") + (level.locked ? \" locked\" : \"\") + \" \" + (levelStatusMap[level.slug] || \"\"))] }, {\"style\":true,\"class\":true,\"data-level-slug\":true,\"data-level-original\":true,\"title\":true})) + \">\");\nif ( level.unlocksHero && (!level.purchasedHero || editorMode) && (level.hidden || levelStatusMap[level.slug] === 'complete'))\n{\nbuf.push(\"<img\" + (jade.attrs({ 'src':(\"/file/db/thang.type/\" + (level.unlocksHero) + \"/portrait.png\"), \"class\": [('hero-portrait')] }, {\"src\":true})) + \"/>\");\n}\nbuf.push(\"<a\" + (jade.attrs({ 'href':(level.type == 'hero' ? '#' : level.disabled ? \"/play\" : \"/play/\" + (level.levelPath || 'level') + \"/\" + (level.slug) + \"\"), 'disabled':(level.disabled), 'data-level-slug':(level.slug), 'data-level-path':(level.levelPath || 'level'), 'data-level-name':(level.name) }, {\"href\":true,\"disabled\":true,\"data-level-slug\":true,\"data-level-path\":true,\"data-level-name\":true})) + \"></a>\");\nif ( levelStatusMap[level.slug] === 'complete')\n{\nbuf.push(\"<img src=\\\"/images/pages/play/star.png\\\" class=\\\"star\\\"/>\");\n}\nif ( editorMode)\n{\nvar kindKey = ((level.kind && level.kind[0]) || \"\").toUpperCase();\nbuf.push(\"<!--if kindKey--><div\" + (jade.attrs({ \"class\": [(\"level-kind \" + level.kind)] }, {\"class\":true})) + \">\" + (jade.escape(null == (jade.interp = kindKey) ? \"\" : jade.interp)) + \"</div>\");\nvar acronym = level.name.replace(/(A |The )/g, '').replace(/[^A-Z]/g, '');\nbuf.push(\"<div class=\\\"level-acronym\\\">\" + (jade.escape(null == (jade.interp = acronym) ? \"\" : jade.interp)) + \"</div>\");\n}\nif ( !level.hidden)\n{\nif ( level.replayable)\n{\nbuf.push(\"<img src=\\\"/images/pages/play/level-banner-replayable.png\\\" class=\\\"banner\\\"/>\");\n}\nelse if ( level.type === 'hero-ladder' || level.type === 'course-ladder')\n{\nbuf.push(\"<img src=\\\"/images/pages/play/level-banner-multiplayer.png\\\" class=\\\"banner\\\"/>\");\n}\nelse if ( ['kithgard-gates', 'siege-of-stonehold', 'clash-of-clones', 'summits-gate', 'kithgard-mastery'].indexOf(level.slug) !== -1 && levelStatusMap[level.slug] !== 'complete')\n{\nbuf.push(\"<img src=\\\"/images/pages/play/level-banner-special.png\\\" class=\\\"banner\\\"/>\");\n}\nelse if ( level.unlocksHero && levelStatusMap[level.slug] !== 'complete')\n{\nbuf.push(\"<img src=\\\"/images/pages/play/level-banner-unlock.png\\\" class=\\\"banner\\\"/><img\" + (jade.attrs({ 'src':(\"/file/db/thang.type/\" + (level.unlocksHero) + \"/portrait.png\"), \"class\": [('hero-portrait'),('hero-portrait-on-banner')] }, {\"src\":true})) + \"/>\");\n}\nelse if ( level.unlocksItem && levelStatusMap[level.slug] !== 'complete')\n{\nbuf.push(\"<img src=\\\"/images/pages/play/level-banner-unlock.png\\\" class=\\\"banner\\\"/><img\" + (jade.attrs({ 'src':(\"/file/db/thang.type/\" + (level.unlocksItem) + \"/portrait.png\"), \"class\": [('item-portrait'),('item-portrait-on-banner')] }, {\"src\":true})) + \"/>\");\n}\nelse if ( levelStatusMap[level.slug] === 'started')\n{\nbuf.push(\"<img src=\\\"/images/pages/play/level-banner-started.png\\\" class=\\\"banner\\\"/>\");\n}\nelse if ( levelStatusMap[level.slug] !== 'complete')\n{\nbuf.push(\"<img src=\\\"/images/pages/play/level-banner-unstarted.png\\\" class=\\\"banner\\\"/>\");\n}\nif ( levelDifficultyMap[level.slug])\n{\nbuf.push(\"<div class=\\\"level-difficulty-banner-text\\\">\" + (jade.escape(null == (jade.interp = levelDifficultyMap[level.slug]) ? \"\" : jade.interp)) + \"</div>\");\n}\n}\nbuf.push(\"</div><div\" + (jade.attrs({ 'style':(\"left: \" + (level.position.x) + \"%; bottom: \" + (level.position.y) + \"%\"), \"class\": [(\"level-shadow\" + (level.next ? \" next\" : \"\") + (level.locked ? \" locked\" : \"\") + \" \" + (levelStatusMap[level.slug] || \"\"))] }, {\"style\":true,\"class\":true})) + \"></div><div\" + (jade.attrs({ 'data-level-slug':(level.slug), 'data-level-path':(level.levelPath || 'level'), 'data-level-name':(level.name), \"class\": [('level-info-container')] }, {\"data-level-slug\":true,\"data-level-path\":true,\"data-level-name\":true})) + \">\");\nvar playCount = levelPlayCountMap[level.slug]\nbuf.push(\"<div class=\\\"progress progress-striped active hide\\\"><div style=\\\"width: 100%\\\" class=\\\"progress-bar\\\"></div></div>\");\nvar showsLeaderboard = levelStatusMap[level.slug] === 'complete' && ((level.scoreTypes && level.scoreTypes.length) || ['hero-ladder', 'course-ladder'].indexOf(level.type) !== -1);\nbuf.push(\"<div\" + (jade.attrs({ \"class\": [(\"level-info \" + (levelStatusMap[level.slug] || \"\") + (level.requiresSubscription ? \" premium\" : \"\") + (showsLeaderboard ? \" shows-leaderboard\" : \"\"))] }, {\"class\":true})) + \"><div class=\\\"level-status\\\"></div><h3>\" + (jade.escape(null == (jade.interp = i18n(level, 'name') + (level.disabled ? \" (\" + translate('common.coming_soon') + \")\" : (level.locked ? \" (\" + translate('play.locked') + \")\" : \"\"))) ? \"\" : jade.interp)) + \"</h3>\");\nvar description = i18n(level, 'description') || level.description || \"\"\nbuf.push(\"<div class=\\\"level-description\\\">\" + (null == (jade.interp = marked(description, {sanitize: !picoCTF})) ? \"\" : jade.interp) + \"</div>\");\nif ( level.disabled)\n{\nbuf.push(\"<p><span data-i18n=\\\"play.awaiting_levels_adventurer_prefix\\\" class=\\\"spr\\\">We release five levels per week.</span><a href=\\\"/contribute/adventurer\\\" class=\\\"spr\\\"><strong data-i18n=\\\"play.awaiting_levels_adventurer\\\">Sign up as an Adventurer</strong></a><span data-i18n=\\\"play.awaiting_levels_adventurer_suffix\\\" class=\\\"spl\\\">to be the first to play new levels.</span></p>\");\n}\nif ( level.displayConcepts && level.displayConcepts.length)\n{\nbuf.push(\"<p>\");\n// iterate level.displayConcepts\n;(function(){\n  var $$obj = level.displayConcepts;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var concept = $$obj[$index];\n\nbuf.push(\"<kbd\" + (jade.attrs({ 'data-i18n':(\"concepts.\" + concept) }, {\"data-i18n\":true})) + \"></kbd>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var concept = $$obj[$index];\n\nbuf.push(\"<kbd\" + (jade.attrs({ 'data-i18n':(\"concepts.\" + concept) }, {\"data-i18n\":true})) + \"></kbd>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</p>\");\n}\nif ( !level.disabled && !level.locked)\n{\nif ( playCount && playCount.sessions)\n{\nbuf.push(\"<div class=\\\"play-counts hidden\\\"><span class=\\\"spl spr\\\">\" + (jade.escape(null == (jade.interp = playCount.sessions) ? \"\" : jade.interp)) + \"</span><span data-i18n=\\\"play.players\\\">players</span><span class=\\\"spr\\\">, \" + (jade.escape((jade.interp = Math.round(playCount.playtime / 3600)) == null ? '' : jade.interp)) + \"</span><span data-i18n=\\\"play.hours_played\\\">hours played</span></div>\");\n}\nif ( showsLeaderboard)\n{\nbuf.push(\"<button\" + (jade.attrs({ 'data-level-slug':(level.slug), \"class\": [('btn'),('btn-warning'),('btn'),('btn-lg'),('btn-illustrated'),('view-solutions')] }, {\"data-level-slug\":true})) + \"><span data-i18n=\\\"leaderboard.scores\\\"></span></button>\");\n}\nbuf.push(\"<button data-i18n=\\\"common.play\\\" class=\\\"btn btn-success btn btn-lg btn-illustrated start-level\\\">Play</button>\");\nif ( me.get('courseInstances') && me.get('courseInstances').length)\n{\nbuf.push(\"<div\" + (jade.attrs({ 'data-level-original':(level.original), \"class\": [('course-version'),('hidden')] }, {\"data-level-original\":true})) + \"><em data-i18n=\\\"general.or\\\"></em>...<br/><button class=\\\"btn btn-primary btn btn-lg btn-illustrated\\\"><span data-i18n=\\\"play.play_classroom_version\\\">Play Classroom Version</span></button></div>\");\n}\n}\nbuf.push(\"</div></div>\");\n    }\n\n  }\n}).call(this);\n\n// iterate adjacentCampaigns\n;(function(){\n  var $$obj = adjacentCampaigns;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var adjacentCampaign = $$obj[$index];\n\nbuf.push(\"<a\" + (jade.attrs({ 'href':((editorMode ? \"/editor/campaign/\" : \"/play/\") + adjacentCampaign.slug) }, {\"href\":true})) + \"><span\" + (jade.attrs({ 'style':(adjacentCampaign.style), 'title':(adjacentCampaign.name), 'data-campaign-id':(adjacentCampaign.id), 'data-campaign-slug':(adjacentCampaign.slug), \"class\": [('glyphicon'),('glyphicon-share-alt'),('campaign-switch')] }, {\"style\":true,\"title\":true,\"data-campaign-id\":true,\"data-campaign-slug\":true})) + \"></span></a>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var adjacentCampaign = $$obj[$index];\n\nbuf.push(\"<a\" + (jade.attrs({ 'href':((editorMode ? \"/editor/campaign/\" : \"/play/\") + adjacentCampaign.slug) }, {\"href\":true})) + \"><span\" + (jade.attrs({ 'style':(adjacentCampaign.style), 'title':(adjacentCampaign.name), 'data-campaign-id':(adjacentCampaign.id), 'data-campaign-slug':(adjacentCampaign.slug), \"class\": [('glyphicon'),('glyphicon-share-alt'),('campaign-switch')] }, {\"style\":true,\"title\":true,\"data-campaign-id\":true,\"data-campaign-slug\":true})) + \"></span></a>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</div>\");\n}\nelse\n{\nbuf.push(\"<div class=\\\"portal\\\"><div class=\\\"portals\\\">\");\n// iterate features.campaignSlugs || ['dungeon', 'beta-campaigns-1', 'forest', 'beta-campaigns-2', 'desert', 'mountain', 'glacier', 'volcano']\n;(function(){\n  var $$obj = features.campaignSlugs || ['dungeon', 'beta-campaigns-1', 'forest', 'beta-campaigns-2', 'desert', 'mountain', 'glacier', 'volcano'];\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var campaignSlug = $$obj[$index];\n\nif ( campaignSlug === 'beta-campaigns-1' || campaignSlug === 'beta-campaigns-2')\n{\nif (features.freeOnly) continue;\nvar betaSlugs = campaignSlug === 'beta-campaigns-1' ? _.shuffle(['campaign-game-dev-1', 'campaign-web-dev-1']) : _.shuffle(['campaign-game-dev-2', 'campaign-web-dev-2']);\nbuf.push(\"<div class=\\\"beta-container\\\">\");\n// iterate betaSlugs\n;(function(){\n  var $$obj = betaSlugs;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var campaignSlug = $$obj[$index];\n\nvar campaign = campaigns[campaignSlug];\nif ( !campaign)\n{\ncontinue;\n}\nbuf.push(\"<div\" + (jade.attrs({ 'data-campaign-slug':(campaignSlug), \"class\": [(\"beta-campaign\" + (campaign ? \"\" : \" silhouette\") + (campaign && campaign.locked && !godmode ? \" locked\" : \"\"))] }, {\"class\":true,\"data-campaign-slug\":true})) + \"><div\" + (jade.attrs({ \"class\": [('background-container'),(\"\" + (campaignSlug) + \"\")] }, {\"class\":true})) + \"></div><div class=\\\"campaign-label\\\"><h3 class=\\\"campaign-name\\\">\");\nif ( campaign)\n{\nbuf.push(\"<span>\" + (jade.escape(null == (jade.interp = i18n(campaign.attributes, 'fullName')) ? \"\" : jade.interp)) + \"</span>\");\nif ( campaign.levelsTotal)\n{\nbuf.push(\"<span class=\\\"spl\\\">\" + (jade.escape(null == (jade.interp = campaign.levelsCompleted) ? \"\" : jade.interp)) + \"</span>/<span>\" + (jade.escape(null == (jade.interp = campaign.levelsTotal) ? \"\" : jade.interp)) + \"</span>\");\n}\n}\nelse\n{\nbuf.push(\"<span>???</span>\");\n}\nbuf.push(\"</h3>\");\nif ( campaign && campaign.locked && !godmode)\n{\nbuf.push(\"<h4 data-i18n=\\\"play.locked\\\" class=\\\"campaign-locked\\\">Locked</h4>\");\n}\nelse if ( campaign)\n{\nbuf.push(\"<btn data-i18n=\\\"common.play\\\" class=\\\"btn btn-illustrated btn-lg btn-primary play-button\\\"></btn>\");\n}\nif ( campaign && campaign.get('description'))\n{\nbuf.push(\"<p class=\\\"campaign-description\\\"><span>\" + (jade.escape(null == (jade.interp = i18n(campaign.attributes, 'description')) ? \"\" : jade.interp)) + \"</span></p>\");\n}\nbuf.push(\"</div></div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var campaignSlug = $$obj[$index];\n\nvar campaign = campaigns[campaignSlug];\nif ( !campaign)\n{\ncontinue;\n}\nbuf.push(\"<div\" + (jade.attrs({ 'data-campaign-slug':(campaignSlug), \"class\": [(\"beta-campaign\" + (campaign ? \"\" : \" silhouette\") + (campaign && campaign.locked && !godmode ? \" locked\" : \"\"))] }, {\"class\":true,\"data-campaign-slug\":true})) + \"><div\" + (jade.attrs({ \"class\": [('background-container'),(\"\" + (campaignSlug) + \"\")] }, {\"class\":true})) + \"></div><div class=\\\"campaign-label\\\"><h3 class=\\\"campaign-name\\\">\");\nif ( campaign)\n{\nbuf.push(\"<span>\" + (jade.escape(null == (jade.interp = i18n(campaign.attributes, 'fullName')) ? \"\" : jade.interp)) + \"</span>\");\nif ( campaign.levelsTotal)\n{\nbuf.push(\"<span class=\\\"spl\\\">\" + (jade.escape(null == (jade.interp = campaign.levelsCompleted) ? \"\" : jade.interp)) + \"</span>/<span>\" + (jade.escape(null == (jade.interp = campaign.levelsTotal) ? \"\" : jade.interp)) + \"</span>\");\n}\n}\nelse\n{\nbuf.push(\"<span>???</span>\");\n}\nbuf.push(\"</h3>\");\nif ( campaign && campaign.locked && !godmode)\n{\nbuf.push(\"<h4 data-i18n=\\\"play.locked\\\" class=\\\"campaign-locked\\\">Locked</h4>\");\n}\nelse if ( campaign)\n{\nbuf.push(\"<btn data-i18n=\\\"common.play\\\" class=\\\"btn btn-illustrated btn-lg btn-primary play-button\\\"></btn>\");\n}\nif ( campaign && campaign.get('description'))\n{\nbuf.push(\"<p class=\\\"campaign-description\\\"><span>\" + (jade.escape(null == (jade.interp = i18n(campaign.attributes, 'description')) ? \"\" : jade.interp)) + \"</span></p>\");\n}\nbuf.push(\"</div></div>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</div>\");\n}\nelse\n{\nvar campaign = campaigns[campaignSlug];\nvar godmode = me.get('permissions', true).indexOf('godmode') != -1;\nbuf.push(\"<div\" + (jade.attrs({ 'data-campaign-slug':(campaignSlug), \"class\": [(\"campaign \" + (campaignSlug) + \"\" + (campaign ? \"\" : \" silhouette\") + (campaign && campaign.locked && !godmode ? \" locked\" : \"\"))] }, {\"class\":true,\"data-campaign-slug\":true})) + \"><div class=\\\"campaign-label\\\"><h2 class=\\\"campaign-name\\\">\");\nif ( campaign)\n{\nbuf.push(\"<span>\" + (jade.escape(null == (jade.interp = i18n(campaign.attributes, 'fullName')) ? \"\" : jade.interp)) + \"</span>\");\n}\nelse\n{\nbuf.push(\"<span>???</span>\");\n}\nbuf.push(\"</h2>\");\nif ( campaign && campaign.levelsTotal)\n{\nbuf.push(\"<h3 class=\\\"levels-completed\\\"><span>\" + (jade.escape(null == (jade.interp = campaign.levelsCompleted) ? \"\" : jade.interp)) + \"</span>/<span>\" + (jade.escape(null == (jade.interp = campaign.levelsTotal) ? \"\" : jade.interp)) + \"</span></h3>\");\n}\nif ( campaign && campaign.locked && !godmode)\n{\nbuf.push(\"<h3 data-i18n=\\\"play.locked\\\" class=\\\"campaign-locked\\\">Locked</h3>\");\n}\nelse if ( campaign)\n{\nbuf.push(\"<btn data-i18n=\\\"common.play\\\" class=\\\"btn btn-illustrated btn-lg btn-success play-button\\\"></btn>\");\n}\nif ( campaign && campaign.get('description'))\n{\nbuf.push(\"<p class=\\\"campaign-description\\\"><span>\" + (jade.escape(null == (jade.interp = i18n(campaign.attributes, 'description')) ? \"\" : jade.interp)) + \"</span></p>\");\n}\nbuf.push(\"</div></div>\");\n}\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var campaignSlug = $$obj[$index];\n\nif ( campaignSlug === 'beta-campaigns-1' || campaignSlug === 'beta-campaigns-2')\n{\nif (features.freeOnly) continue;\nvar betaSlugs = campaignSlug === 'beta-campaigns-1' ? _.shuffle(['campaign-game-dev-1', 'campaign-web-dev-1']) : _.shuffle(['campaign-game-dev-2', 'campaign-web-dev-2']);\nbuf.push(\"<div class=\\\"beta-container\\\">\");\n// iterate betaSlugs\n;(function(){\n  var $$obj = betaSlugs;\n  if ('number' == typeof $$obj.length) {\n\n    for (var $index = 0, $$l = $$obj.length; $index < $$l; $index++) {\n      var campaignSlug = $$obj[$index];\n\nvar campaign = campaigns[campaignSlug];\nif ( !campaign)\n{\ncontinue;\n}\nbuf.push(\"<div\" + (jade.attrs({ 'data-campaign-slug':(campaignSlug), \"class\": [(\"beta-campaign\" + (campaign ? \"\" : \" silhouette\") + (campaign && campaign.locked && !godmode ? \" locked\" : \"\"))] }, {\"class\":true,\"data-campaign-slug\":true})) + \"><div\" + (jade.attrs({ \"class\": [('background-container'),(\"\" + (campaignSlug) + \"\")] }, {\"class\":true})) + \"></div><div class=\\\"campaign-label\\\"><h3 class=\\\"campaign-name\\\">\");\nif ( campaign)\n{\nbuf.push(\"<span>\" + (jade.escape(null == (jade.interp = i18n(campaign.attributes, 'fullName')) ? \"\" : jade.interp)) + \"</span>\");\nif ( campaign.levelsTotal)\n{\nbuf.push(\"<span class=\\\"spl\\\">\" + (jade.escape(null == (jade.interp = campaign.levelsCompleted) ? \"\" : jade.interp)) + \"</span>/<span>\" + (jade.escape(null == (jade.interp = campaign.levelsTotal) ? \"\" : jade.interp)) + \"</span>\");\n}\n}\nelse\n{\nbuf.push(\"<span>???</span>\");\n}\nbuf.push(\"</h3>\");\nif ( campaign && campaign.locked && !godmode)\n{\nbuf.push(\"<h4 data-i18n=\\\"play.locked\\\" class=\\\"campaign-locked\\\">Locked</h4>\");\n}\nelse if ( campaign)\n{\nbuf.push(\"<btn data-i18n=\\\"common.play\\\" class=\\\"btn btn-illustrated btn-lg btn-primary play-button\\\"></btn>\");\n}\nif ( campaign && campaign.get('description'))\n{\nbuf.push(\"<p class=\\\"campaign-description\\\"><span>\" + (jade.escape(null == (jade.interp = i18n(campaign.attributes, 'description')) ? \"\" : jade.interp)) + \"</span></p>\");\n}\nbuf.push(\"</div></div>\");\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in $$obj) {\n      $$l++;      var campaignSlug = $$obj[$index];\n\nvar campaign = campaigns[campaignSlug];\nif ( !campaign)\n{\ncontinue;\n}\nbuf.push(\"<div\" + (jade.attrs({ 'data-campaign-slug':(campaignSlug), \"class\": [(\"beta-campaign\" + (campaign ? \"\" : \" silhouette\") + (campaign && campaign.locked && !godmode ? \" locked\" : \"\"))] }, {\"class\":true,\"data-campaign-slug\":true})) + \"><div\" + (jade.attrs({ \"class\": [('background-container'),(\"\" + (campaignSlug) + \"\")] }, {\"class\":true})) + \"></div><div class=\\\"campaign-label\\\"><h3 class=\\\"campaign-name\\\">\");\nif ( campaign)\n{\nbuf.push(\"<span>\" + (jade.escape(null == (jade.interp = i18n(campaign.attributes, 'fullName')) ? \"\" : jade.interp)) + \"</span>\");\nif ( campaign.levelsTotal)\n{\nbuf.push(\"<span class=\\\"spl\\\">\" + (jade.escape(null == (jade.interp = campaign.levelsCompleted) ? \"\" : jade.interp)) + \"</span>/<span>\" + (jade.escape(null == (jade.interp = campaign.levelsTotal) ? \"\" : jade.interp)) + \"</span>\");\n}\n}\nelse\n{\nbuf.push(\"<span>???</span>\");\n}\nbuf.push(\"</h3>\");\nif ( campaign && campaign.locked && !godmode)\n{\nbuf.push(\"<h4 data-i18n=\\\"play.locked\\\" class=\\\"campaign-locked\\\">Locked</h4>\");\n}\nelse if ( campaign)\n{\nbuf.push(\"<btn data-i18n=\\\"common.play\\\" class=\\\"btn btn-illustrated btn-lg btn-primary play-button\\\"></btn>\");\n}\nif ( campaign && campaign.get('description'))\n{\nbuf.push(\"<p class=\\\"campaign-description\\\"><span>\" + (jade.escape(null == (jade.interp = i18n(campaign.attributes, 'description')) ? \"\" : jade.interp)) + \"</span></p>\");\n}\nbuf.push(\"</div></div>\");\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</div>\");\n}\nelse\n{\nvar campaign = campaigns[campaignSlug];\nvar godmode = me.get('permissions', true).indexOf('godmode') != -1;\nbuf.push(\"<div\" + (jade.attrs({ 'data-campaign-slug':(campaignSlug), \"class\": [(\"campaign \" + (campaignSlug) + \"\" + (campaign ? \"\" : \" silhouette\") + (campaign && campaign.locked && !godmode ? \" locked\" : \"\"))] }, {\"class\":true,\"data-campaign-slug\":true})) + \"><div class=\\\"campaign-label\\\"><h2 class=\\\"campaign-name\\\">\");\nif ( campaign)\n{\nbuf.push(\"<span>\" + (jade.escape(null == (jade.interp = i18n(campaign.attributes, 'fullName')) ? \"\" : jade.interp)) + \"</span>\");\n}\nelse\n{\nbuf.push(\"<span>???</span>\");\n}\nbuf.push(\"</h2>\");\nif ( campaign && campaign.levelsTotal)\n{\nbuf.push(\"<h3 class=\\\"levels-completed\\\"><span>\" + (jade.escape(null == (jade.interp = campaign.levelsCompleted) ? \"\" : jade.interp)) + \"</span>/<span>\" + (jade.escape(null == (jade.interp = campaign.levelsTotal) ? \"\" : jade.interp)) + \"</span></h3>\");\n}\nif ( campaign && campaign.locked && !godmode)\n{\nbuf.push(\"<h3 data-i18n=\\\"play.locked\\\" class=\\\"campaign-locked\\\">Locked</h3>\");\n}\nelse if ( campaign)\n{\nbuf.push(\"<btn data-i18n=\\\"common.play\\\" class=\\\"btn btn-illustrated btn-lg btn-success play-button\\\"></btn>\");\n}\nif ( campaign && campaign.get('description'))\n{\nbuf.push(\"<p class=\\\"campaign-description\\\"><span>\" + (jade.escape(null == (jade.interp = i18n(campaign.attributes, 'description')) ? \"\" : jade.interp)) + \"</span></p>\");\n}\nbuf.push(\"</div></div>\");\n}\n    }\n\n  }\n}).call(this);\n\nbuf.push(\"</div></div>\");\n}\nbuf.push(\"<div class=\\\"game-controls header-font picoctf-hide\\\"><button data-i18n=\\\"[title]play.poll\\\" class=\\\"btn poll hidden\\\"></button>\");\nif ( !features.codePlay)\n{\nbuf.push(\"<a href=\\\"/clans\\\" data-i18n=\\\"[title]clans.clans\\\" class=\\\"btn clans\\\"></a>\");\n}\nbuf.push(\"<button data-toggle=\\\"coco-modal\\\" data-target=\\\"play/modal/PlayItemsModal\\\" data-i18n=\\\"[title]play.items\\\" class=\\\"btn items\\\"></button><button data-toggle=\\\"coco-modal\\\" data-target=\\\"play/modal/PlayHeroesModal\\\" data-i18n=\\\"[title]play.heroes\\\" class=\\\"btn heroes\\\"></button><button data-toggle=\\\"coco-modal\\\" data-target=\\\"play/modal/PlayAchievementsModal\\\" data-i18n=\\\"[title]play.achievements\\\" class=\\\"btn achievements\\\"></button>\");\nif ( !me.get('anonymous', true) && !features.codePlay)\n{\nbuf.push(\"<a href=\\\"/account/settings\\\" data-original-title=\\\"Configurao\\\" class=\\\"btn account\\\"></a>\");\n}\nbuf.push(\"</div><div class=\\\"user-status header-font picoctf-hide\\\"><div class=\\\"user-status-line\\\"><span class=\\\"gem gem-30\\\"></span><span id=\\\"gems-count\\\" class=\\\"spr\\\">\" + (jade.escape(null == (jade.interp = me.gems()) ? \"\" : jade.interp)) + \"</span><span data-i18n=\\\"general.player_level\\\" class=\\\"level-indicator\\\"></span><span class=\\\"player-level spr\\\">\" + (jade.escape(null == (jade.interp = me.level()) ? \"\" : jade.interp)) + \"</span><span class=\\\"player-hero-icon\\\"></span>\");\nif ( me.get('anonymous'))\n{\nbuf.push(\"<span data-i18n=\\\"play.anonymous\\\" class=\\\"player-name spr\\\">Anonymous Player</span><button data-i18n=\\\"login.log_in\\\" class=\\\"btn btn-illustrated login-button btn-warning\\\"></button><button data-i18n=\\\"signup.sign_up\\\" class=\\\"btn btn-illustrated signup-button btn-danger\\\"></button>\");\n}\nelse\n{\nbuf.push(\"<a href=\\\"/account/settings\\\" class=\\\"player-name spr\\\">\" + (jade.escape(null == (jade.interp = me.get('name')) ? \"\" : jade.interp)) + \"</a><button id=\\\"logout-button\\\" data-i18n=\\\"login.log_out\\\" class=\\\"btn btn-illustrated btn-warning\\\">Log Out</button>\");\nif ( me.isPremium())\n{\nbuf.push(\"<button data-i18n=\\\"nav.contact\\\" data-toggle=\\\"coco-modal\\\" data-target=\\\"core/ContactModal\\\" class=\\\"btn btn-illustrated btn-primary\\\">Contact</button>\");\n}\n}\nbuf.push(\"</div></div><button id=\\\"volume-button\\\" data-i18n=\\\"[title]play.adjust_volume\\\" title=\\\"Adjust volume\\\" class=\\\"btn btn-lg btn-inverse campaign-control-button picoctf-hide\\\"><div class=\\\"glyphicon glyphicon-volume-off\\\"></div><div class=\\\"glyphicon glyphicon-volume-down\\\"></div><div class=\\\"glyphicon glyphicon-volume-up\\\"></div></button>\");\nif ( campaign && !editorMode)\n{\nbuf.push(\"<button id=\\\"back-button\\\" data-i18n=\\\"[title]resources.campaigns\\\" title=\\\"Campaigns\\\" class=\\\"btn btn-lg btn-inverse campaign-control-button picoctf-hide\\\"><div class=\\\"glyphicon glyphicon-globe\\\"></div></button>\");\n}\nif ( editorMode)\n{\nbuf.push(\"<button id=\\\"clear-storage-button\\\" data-i18n=\\\"[title]editor.clear_storage\\\" title=\\\"Clear your local changes\\\" class=\\\"btn btn-lg btn-inverse campaign-control-button\\\"><div class=\\\"glyphicon glyphicon-refresh\\\"></div></button>\");\n}\nif ( campaign && campaign.loaded)\n{\nbuf.push(\"<h1 id=\\\"campaign-status\\\" class=\\\"picoctf-hide\\\"><div class=\\\"campaign-status-background\\\"><div class=\\\"campaign-name\\\"><span>\" + (jade.escape(null == (jade.interp = i18n(campaign.attributes, 'fullName')) ? \"\" : jade.interp)) + \"</span></div><div class=\\\"levels-completed\\\"><span>\" + (jade.escape(null == (jade.interp = levelsCompleted) ? \"\" : jade.interp)) + \"</span>/<span>\" + (jade.escape(null == (jade.interp = levelsTotal) ? \"\" : jade.interp)) + \"</span></div></div></h1>\");\n}\nbuf.push(\"</div>\");\nif ( campaign && !me.finishedAnyLevels() && serverConfig.showCodePlayAds)\n{\nbuf.push(\"<a href=\\\"https://lenovogamestate.com/\\\">\");\nvar url = \"/images/common/codeplay/NA_LevelsPage_Cube_160x480.png\"\nif ( me.isFromUk())\n{\nurl = \"/images/common/codeplay/UK_LevelsPage_Cube_160x480.png\"\n}\nbuf.push(\"<img\" + (jade.attrs({ 'id':('codeplay-ad'), 'src':(url) }, {\"src\":true})) + \"/></a>\");\n};return buf.join(\"\");\n};\nif (typeof define === 'function' && define.amd) {\n  define([], function() {\n    return __templateData;\n  });\n} else if (typeof module === 'object' && module && module.exports) {\n  module.exports = __templateData;\n} else {\n  __templateData;\n}","RootView = require 'views/core/RootView'\r\ntemplate = require 'templates/play/campaign-view'\r\nLevelSession = require 'models/LevelSession'\r\nEarnedAchievement = require 'models/EarnedAchievement'\r\nCocoCollection = require 'collections/CocoCollection'\r\nCampaign = require 'models/Campaign'\r\nAudioPlayer = require 'lib/AudioPlayer'\r\nLevelSetupManager = require 'lib/LevelSetupManager'\r\nThangType = require 'models/ThangType'\r\nMusicPlayer = require 'lib/surface/MusicPlayer'\r\nstorage = require 'core/storage'\r\nCreateAccountModal = require 'views/core/CreateAccountModal'\r\nSubscribeModal = require 'views/core/SubscribeModal'\r\nLeaderboardModal = require 'views/play/modal/LeaderboardModal'\r\nLevel = require 'models/Level'\r\nutils = require 'core/utils'\r\nrequire 'vendor/three'\r\nParticleMan = require 'core/ParticleMan'\r\nShareProgressModal = require 'views/play/modal/ShareProgressModal'\r\nUserPollsRecord = require 'models/UserPollsRecord'\r\nPoll = require 'models/Poll'\r\nPollModal = require 'views/play/modal/PollModal'\r\nCourseInstance = require 'models/CourseInstance'\r\n\r\nrequire 'game-libraries'\r\n\r\nclass LevelSessionsCollection extends CocoCollection\r\n  url: ''\r\n  model: LevelSession\r\n\r\n  constructor: (model) ->\r\n    super()\r\n    @url = \"/db/user/#{me.id}/level.sessions?project=state.complete,levelID,state.difficulty,playtime\"\r\n\r\nclass CampaignsCollection extends CocoCollection\r\n  # We don't send all of levels, just the parts needed in countLevels\r\n  url: '/db/campaign/-/overworld?project=slug,adjacentCampaigns,name,fullName,description,i18n,color,levels'\r\n  model: Campaign\r\n\r\nmodule.exports = class CampaignView extends RootView\r\n  id: 'campaign-view'\r\n  template: template\r\n\r\n  subscriptions:\r\n    'subscribe-modal:subscribed': 'onSubscribed'\r\n\r\n  events:\r\n    'click .map-background': 'onClickMap'\r\n    'click .level a': 'onClickLevel'\r\n    'dblclick .level a': 'onDoubleClickLevel'\r\n    'click .level-info-container .start-level': 'onClickStartLevel'\r\n    'click .level-info-container .view-solutions': 'onClickViewSolutions'\r\n    'click .level-info-container .course-version button': 'onClickCourseVersion'\r\n    'click #volume-button': 'onToggleVolume'\r\n    'click #back-button': 'onClickBack'\r\n    'click #clear-storage-button': 'onClickClearStorage'\r\n    'click .portal .campaign': 'onClickPortalCampaign'\r\n    'click .portal .beta-campaign': 'onClickPortalCampaign'\r\n    'click a .campaign-switch': 'onClickCampaignSwitch'\r\n    'mouseenter .portals': 'onMouseEnterPortals'\r\n    'mouseleave .portals': 'onMouseLeavePortals'\r\n    'mousemove .portals': 'onMouseMovePortals'\r\n    'click .poll': 'showPoll'\r\n  shortcuts:\r\n    'shift+s': 'onShiftS'\r\n\r\n  constructor: (options, @terrain) ->\r\n    super options\r\n    @terrain = 'picoctf' if window.serverConfig.picoCTF\r\n    @editorMode = options?.editorMode\r\n    @requiresSubscription = not me.isPremium()\r\n    if @editorMode\r\n      @terrain ?= 'dungeon'\r\n    @levelStatusMap = {}\r\n    @levelPlayCountMap = {}\r\n    @levelDifficultyMap = {}\r\n\r\n    if utils.getQueryVariable('hour_of_code')\r\n      me.set('hourOfCode', true)\r\n      me.patch()\r\n      pixelCode = if @terrain is 'game-dev-hoc' then 'code_combat_gamedev' else 'code_combat'\r\n      $('body').append($(\"<img src='https://code.org/api/hour/begin_#{pixelCode}.png' style='visibility: hidden;'>\"))\r\n\r\n    # HoC: Fake us up a \"mode\" for HeroVictoryModal to return hero without levels realizing they're in a copycat campaign, or clear it if we started playing.\r\n    shouldReturnToGameDevHoc = @terrain is 'game-dev-hoc'\r\n    storage.save 'should-return-to-game-dev-hoc', shouldReturnToGameDevHoc\r\n\r\n    if window.serverConfig.picoCTF\r\n      @supermodel.addRequestResource(url: '/picoctf/problems', success: (@picoCTFProblems) =>).load()\r\n    else\r\n      unless @editorMode\r\n        @sessions = @supermodel.loadCollection(new LevelSessionsCollection(), 'your_sessions', {cache: false}, 0).model\r\n        @listenToOnce @sessions, 'sync', @onSessionsLoaded\r\n      unless @terrain\r\n        @campaigns = @supermodel.loadCollection(new CampaignsCollection(), 'campaigns', null, 1).model\r\n        @listenToOnce @campaigns, 'sync', @onCampaignsLoaded\r\n        return\r\n\r\n    @campaign = new Campaign({_id:@terrain})\r\n    @campaign = @supermodel.loadModel(@campaign).model\r\n\r\n    # Temporary attempt to make sure all earned rewards are accounted for. Figure out a better solution...\r\n    @earnedAchievements = new CocoCollection([], {url: '/db/earned_achievement', model:EarnedAchievement, project: ['earnedRewards']})\r\n    @listenToOnce @earnedAchievements, 'sync', ->\r\n      earned = me.get('earned')\r\n      for m in @earnedAchievements.models\r\n        continue unless loadedEarned = m.get('earnedRewards')\r\n        for group in ['heroes', 'levels', 'items']\r\n          continue unless loadedEarned[group]\r\n          for reward in loadedEarned[group]\r\n            if reward not in earned[group]\r\n              console.warn 'Filling in a gap for reward', group, reward\r\n              earned[group].push(reward)\r\n\r\n    @supermodel.loadCollection(@earnedAchievements, 'achievements', {cache: false})\r\n\r\n    @listenToOnce @campaign, 'sync', @getLevelPlayCounts\r\n    $(window).on 'resize', @onWindowResize\r\n    @probablyCachedMusic = storage.load(\"loaded-menu-music\")\r\n    musicDelay = if @probablyCachedMusic then 1000 else 10000\r\n    @playMusicTimeout = _.delay (=> @playMusic() unless @destroyed), musicDelay\r\n    @hadEverChosenHero = me.get('heroConfig')?.thangType\r\n    @listenTo me, 'change:purchased', -> @renderSelectors('#gems-count')\r\n    @listenTo me, 'change:spent', -> @renderSelectors('#gems-count')\r\n    @listenTo me, 'change:earned', -> @renderSelectors('#gems-count')\r\n    @listenTo me, 'change:heroConfig', -> @updateHero()\r\n    window.tracker?.trackEvent 'Loaded World Map', category: 'World Map', label: @terrain\r\n\r\n  destroy: ->\r\n    @setupManager?.destroy()\r\n    @$el.find('.ui-draggable').off().draggable 'destroy'\r\n    $(window).off 'resize', @onWindowResize\r\n    if ambientSound = @ambientSound\r\n      # Doesn't seem to work; stops immediately.\r\n      createjs.Tween.get(ambientSound).to({volume: 0.0}, 1500).call -> ambientSound.stop()\r\n    @musicPlayer?.destroy()\r\n    clearTimeout @playMusicTimeout\r\n    @particleMan?.destroy()\r\n    clearInterval @portalScrollInterval\r\n    super()\r\n\r\n  showLoading: ($el) ->\r\n    unless @campaign\r\n      @$el.find('.game-controls, .user-status').addClass 'hidden'\r\n      @$el.find('.portal .campaign-name span').text $.i18n.t 'common.loading'\r\n\r\n  hideLoading: ->\r\n    unless @campaign\r\n      @$el.find('.game-controls, .user-status').removeClass 'hidden'\r\n\r\n  getLevelPlayCounts: ->\r\n    return unless me.isAdmin()\r\n    return  # TODO: get rid of all this? It's redundant with new campaign editor analytics, unless we want to show player counts on leaderboards buttons.\r\n    success = (levelPlayCounts) =>\r\n      return if @destroyed\r\n      for level in levelPlayCounts\r\n        @levelPlayCountMap[level._id] = playtime: level.playtime, sessions: level.sessions\r\n      @render() if @fullyRendered\r\n\r\n    levelSlugs = (level.slug for levelID, level of @campaign.get 'levels')\r\n    levelPlayCountsRequest = @supermodel.addRequestResource 'play_counts', {\r\n      url: '/db/level/-/play_counts'\r\n      data: {ids: levelSlugs}\r\n      method: 'POST'\r\n      success: success\r\n    }, 0\r\n    levelPlayCountsRequest.load()\r\n\r\n  onLoaded: ->\r\n    return if @fullyRendered\r\n    @fullyRendered = true\r\n    @render()\r\n    @preloadTopHeroes() unless me.get('heroConfig')?.thangType\r\n    @$el.find('#campaign-status').delay(4000).animate({top: \"-=58\"}, 1000) unless @terrain is 'dungeon'\r\n    if not me.get('hourOfCode') and @terrain\r\n      if me.get('anonymous') and me.get('lastLevel') is 'shadow-guard' and me.level() < 4\r\n        @openModalView new CreateAccountModal supermodel: @supermodel, showSignupRationale: true\r\n      else if me.get('name') and me.get('lastLevel') in ['forgetful-gemsmith', 'signs-and-portents'] and\r\n      me.level() < 5 and not (me.get('ageRange') in ['18-24', '25-34', '35-44', '45-100']) and\r\n      not storage.load('sent-parent-email') and not me.isPremium()\r\n        @openModalView new ShareProgressModal()\r\n\r\n  setCampaign: (@campaign) ->\r\n    @render()\r\n\r\n  onSubscribed: ->\r\n    @requiresSubscription = false\r\n    @render()\r\n\r\n  getRenderData: (context={}) ->\r\n    context = super(context)\r\n    context.campaign = @campaign\r\n    context.levels = _.values($.extend true, {}, @campaign?.get('levels') ? {})\r\n    if me.level() < 12 and @terrain is 'dungeon' and not @editorMode\r\n      reject = if me.getFourthLevelGroup() is 'signs-and-portents' then 'forgetful-gemsmith' else 'signs-and-portents'\r\n      context.levels = _.reject context.levels, slug: reject\r\n    if features.freeOnly\r\n      context.levels = _.reject context.levels, 'requiresSubscription'\r\n    @annotateLevels(context.levels)\r\n    count = @countLevels context.levels\r\n    context.levelsCompleted = count.completed\r\n    context.levelsTotal = count.total\r\n\r\n    @determineNextLevel context.levels if @sessions?.loaded or @editorMode\r\n    # put lower levels in last, so in the world map they layer over one another properly.\r\n    context.levels = (_.sortBy context.levels, (l) -> l.position.y).reverse()\r\n    @campaign.renderedLevels = context.levels if @campaign\r\n\r\n    context.levelStatusMap = @levelStatusMap\r\n    context.levelDifficultyMap = @levelDifficultyMap\r\n    context.levelPlayCountMap = @levelPlayCountMap\r\n    context.isIPadApp = application.isIPadApp\r\n    context.picoCTF = window.serverConfig.picoCTF\r\n    context.requiresSubscription = @requiresSubscription\r\n    context.editorMode = @editorMode\r\n    context.adjacentCampaigns = _.filter _.values(_.cloneDeep(@campaign?.get('adjacentCampaigns') or {})), (ac) =>\r\n      if ac.showIfUnlocked and not @editorMode\r\n        return false if _.isString(ac.showIfUnlocked) and ac.showIfUnlocked not in me.levels()\r\n        return false if _.isArray(ac.showIfUnlocked) and _.intersection(ac.showIfUnlocked, me.levels()).length <= 0\r\n      ac.name = utils.i18n ac, 'name'\r\n      styles = []\r\n      styles.push \"color: #{ac.color}\" if ac.color\r\n      styles.push \"transform: rotate(#{ac.rotation}deg)\" if ac.rotation\r\n      ac.position ?= { x: 10, y: 10 }\r\n      styles.push \"left: #{ac.position.x}%\"\r\n      styles.push \"top: #{ac.position.y}%\"\r\n      ac.style = styles.join('; ')\r\n      return true\r\n    context.marked = marked\r\n    context.i18n = utils.i18n\r\n\r\n    if @campaigns\r\n      context.campaigns = {}\r\n      for campaign in @campaigns.models when campaign.get('slug') isnt 'auditions'\r\n        context.campaigns[campaign.get('slug')] = campaign\r\n        if @sessions?.loaded\r\n          levels = _.values($.extend true, {}, campaign.get('levels') ? {})\r\n          count = @countLevels levels\r\n          campaign.levelsTotal = count.total\r\n          campaign.levelsCompleted = count.completed\r\n          if campaign.get('slug') is 'dungeon'\r\n            campaign.locked = false\r\n          else unless campaign.levelsTotal\r\n            campaign.locked = true\r\n          else\r\n            campaign.locked = true\r\n      for campaign in @campaigns.models\r\n        for acID, ac of campaign.get('adjacentCampaigns') ? {}\r\n          if _.isString(ac.showIfUnlocked)\r\n            _.find(@campaigns.models, id: acID)?.locked = false if ac.showIfUnlocked in me.levels()\r\n          else if _.isArray(ac.showIfUnlocked)\r\n            _.find(@campaigns.models, id: acID)?.locked = false if _.intersection(ac.showIfUnlocked, me.levels()).length > 0\r\n\r\n    context\r\n\r\n  afterRender: ->\r\n    super()\r\n    @onWindowResize()\r\n    unless application.isIPadApp\r\n      _.defer => @$el?.find('.game-controls .btn:not(.poll)').addClass('has-tooltip').tooltip()  # Have to defer or i18n doesn't take effect.\r\n      view = @\r\n      @$el.find('.level, .campaign-switch').addClass('has-tooltip').tooltip().each ->\r\n        return unless me.isAdmin() and view.editorMode\r\n        $(@).draggable().on 'dragstop', ->\r\n          bg = $('.map-background')\r\n          x = ($(@).offset().left - bg.offset().left + $(@).outerWidth() / 2) / bg.width()\r\n          y = 1 - ($(@).offset().top - bg.offset().top + $(@).outerHeight() / 2) / bg.height()\r\n          e = { position: { x: (100 * x), y: (100 * y) }, levelOriginal: $(@).data('level-original'), campaignID: $(@).data('campaign-id') }\r\n          view.trigger 'level-moved', e if e.levelOriginal\r\n          view.trigger 'adjacent-campaign-moved', e if e.campaignID\r\n    @updateVolume()\r\n    @updateHero()\r\n    unless window.currentModal or not @fullyRendered\r\n      @highlightElement '.level.next', delay: 500, duration: 60000, rotation: 0, sides: ['top']\r\n      @createLines() if @editorMode\r\n      @showLeaderboard @options.justBeatLevel?.get('slug') if @options.showLeaderboard# or true  # Testing\r\n    @applyCampaignStyles()\r\n    @testParticles()\r\n\r\n  onShiftS: (e) ->\r\n    @generateCompletionRates() if @editorMode\r\n\r\n  generateCompletionRates: ->\r\n    return unless me.isAdmin()\r\n    startDay = utils.getUTCDay -14\r\n    endDay = utils.getUTCDay -1\r\n    $(\".map-background\").css('background-image','none')\r\n    $(\".gradient\").remove()\r\n    $(\"#campaign-view\").css(\"background-color\", \"black\")\r\n    for level in @campaign?.renderedLevels ? []\r\n      $(\"div[data-level-slug=#{level.slug}] .level-kind\").text(\"Loading...\")\r\n      request = @supermodel.addRequestResource 'level_completions', {\r\n        url: '/db/analytics_perday/-/level_completions'\r\n        data: {startDay: startDay, endDay: endDay, slug: level.slug}\r\n        method: 'POST'\r\n        success: @onLevelCompletionsLoaded.bind(@, level)\r\n      }, 0\r\n      request.load()\r\n    \r\n  onLevelCompletionsLoaded: (level, data) ->\r\n    return if @destroyed\r\n    started = 0\r\n    finished = 0\r\n    for day in data\r\n      started += day.started ? 0\r\n      finished += day.finished ? 0\r\n    if started is 0\r\n      ratio = 0\r\n    else\r\n      ratio = finished / started\r\n    rateDisplay = (ratio * 100).toFixed(1) + '%'\r\n    $(\"div[data-level-slug=#{level.slug}] .level-kind\").html((if started < 1000 then started else (started / 1000).toFixed(1) + \"k\") + \"<br>\" + rateDisplay)\r\n    if ratio <= 0.5\r\n      color = \"rgb(255, 0, 0)\"\r\n    else if ratio > 0.5 and ratio <= 0.85\r\n      offset = (ratio - 0.5) / 0.35\r\n      color = \"rgb(255, #{Math.round(256 * offset)}, 0)\"\r\n    else if ratio > 0.85 and ratio <= 0.95\r\n      offset = (ratio - 0.85) / 0.1\r\n      color = \"rgb(#{Math.round(256 * (1-offset))}, 256, 0)\"\r\n    else\r\n      color = \"rgb(0, 256, 0)\"\r\n    $(\"div[data-level-slug=#{level.slug}] .level-kind\").css({\"color\":color, \"width\":256+\"px\", \"transform\":\"translateX(-50%) translateX(15px)\"})\r\n    $(\"div[data-level-slug=#{level.slug}]\").css(\"background-color\", color)\r\n\r\n  afterInsert: ->\r\n    super()\r\n    if @getQueryVariable('signup') and not me.get('email')\r\n      return @promptForSignup()\r\n    if not me.isPremium() and (@isPremiumCampaign() or (@options.worldComplete and not features.freeOnly))\r\n      if not me.get('email')\r\n        return @promptForSignup()\r\n      campaignSlug = window.location.pathname.split('/')[2]\r\n      return @promptForSubscription campaignSlug, 'premium campaign visited'\r\n\r\n  promptForSignup: ->\r\n    @endHighlight()\r\n    authModal = new CreateAccountModal supermodel: @supermodel\r\n    authModal.mode = 'signup'\r\n    @openModalView authModal\r\n\r\n  promptForSubscription: (slug, label) ->\r\n    @endHighlight()\r\n    @openModalView new SubscribeModal()\r\n    # TODO: Added levelID on 2/9/16. Remove level property and associated AnalyticsLogEvent 'properties.level' index later.\r\n    window.tracker?.trackEvent 'Show subscription modal', category: 'Subscription', label: label, level: slug, levelID: slug\r\n\r\n  isPremiumCampaign: (slug) ->\r\n    slug ||= window.location.pathname.split('/')[2]\r\n    /campaign-(game|web)-dev-\\d/.test slug\r\n\r\n  showAds: ->\r\n    return false # No ads for now.\r\n    if application.isProduction() && !me.isPremium() && !me.isTeacher() && !window.serverConfig.picoCTF\r\n      return me.getCampaignAdsGroup() is 'leaderboard-ads'\r\n    false\r\n\r\n  annotateLevels: (orderedLevels) ->\r\n    previousIncompletePracticeLevel = false # Lock owned levels if there's a earlier incomplete practice level to play\r\n    for level, levelIndex in orderedLevels\r\n      level.position ?= { x: 10, y: 10 }\r\n      level.locked = not me.ownsLevel(level.original) or previousIncompletePracticeLevel\r\n      level.locked = true if level.slug is 'kithgard-mastery' and @calculateExperienceScore() is 0\r\n      level.locked = true if level.requiresSubscription and @requiresSubscription and me.get('hourOfCode')\r\n      level.locked = true if level.slug in me.getDungeonLevelsHidden()\r\n      level.locked = false if @levelStatusMap[level.slug] in ['started', 'complete']\r\n      level.locked = false if @editorMode\r\n      level.locked = false if @campaign?.get('name') in ['Auditions', 'Intro']\r\n      level.locked = false if me.isInGodMode()\r\n      level.disabled = true if level.adminOnly and @levelStatusMap[level.slug] not in ['started', 'complete']\r\n      level.disabled = false if me.isInGodMode()\r\n      level.color = 'rgb(255, 80, 60)'\r\n      level.color = 'rgb(80, 130, 200)' if level.requiresSubscription\r\n      level.color = 'rgb(200, 80, 200)' if level.adventurer\r\n      level.color = 'rgb(193, 193, 193)' if level.locked\r\n      level.unlocksHero = _.find(level.rewards, 'hero')?.hero\r\n      if level.unlocksHero\r\n        level.purchasedHero = level.unlocksHero in (me.get('purchased')?.heroes or [])\r\n      level.unlocksItem = _.find(level.rewards, 'item')?.item\r\n\r\n      if window.serverConfig.picoCTF\r\n        if problem = _.find(@picoCTFProblems or [], pid: level.picoCTFProblem)\r\n          level.locked = false if problem.unlocked or level.slug is 'digital-graffiti'\r\n          #level.locked = false  # Testing to see all levels\r\n          level.description = \"\"\"\r\n            ### #{problem.name}\r\n            #{level.description or problem.description}\r\n\r\n            #{problem.category} - #{problem.score} points\r\n          \"\"\"\r\n          level.color = 'rgb(80, 130, 200)' if problem.solved\r\n\r\n      if @campaign?.levelIsPractice(level) and not level.locked and @levelStatusMap[level.slug] isnt 'complete' and\r\n      (not level.requiresSubscription or level.adventurer or not @requiresSubscription)\r\n        previousIncompletePracticeLevel = true\r\n\r\n      level.hidden = level.locked\r\n      if level.concepts?.length\r\n        level.displayConcepts = level.concepts\r\n        maxConcepts = 6\r\n        if level.displayConcepts.length > maxConcepts\r\n          level.displayConcepts = level.displayConcepts.slice -maxConcepts\r\n\r\n      level.unlockedInSameCampaign = levelIndex < 5  # First few are always counted (probably unlocked in previous campaign)\r\n      for otherLevel in orderedLevels when not level.unlockedInSameCampaign and otherLevel isnt level\r\n        for reward in (otherLevel.rewards ? []) when reward.level\r\n          level.unlockedInSameCampaign ||= reward.level is level.original\r\n      level.unlockedInSameCampaign = false if level.slug in me.getDungeonLevelsHidden()\r\n\r\n  countLevels: (orderedLevels) ->\r\n    count = total: 0, completed: 0\r\n\r\n    if @campaign?.get('slug') is 'game-dev-hoc'\r\n      # HoC: Just order left-to-right instead of looking at unlocks, which we don't use for this copycat campaign\r\n      orderedLevels = _.sortBy orderedLevels, (level) -> level.position.x\r\n      count.completed++ for level in orderedLevels when @levelStatusMap[level.slug] is 'complete'\r\n      count.total = orderedLevels.length\r\n      return count\r\n\r\n    for level, levelIndex in orderedLevels\r\n      @annotateLevels(orderedLevels) unless level.locked?  # Annotate if we haven't already.\r\n      continue if level.disabled\r\n      completed = @levelStatusMap[level.slug] is 'complete'\r\n      started = @levelStatusMap[level.slug] is 'started'\r\n      ++count.total if (level.unlockedInSameCampaign or not level.locked) and (started or completed or not @campaign?.levelIsPractice(level))\r\n      ++count.completed if completed\r\n    count\r\n\r\n  showLeaderboard: (levelSlug) ->\r\n    leaderboardModal = new LeaderboardModal supermodel: @supermodel, levelSlug: levelSlug\r\n    @openModalView leaderboardModal\r\n\r\n  determineNextLevel: (orderedLevels) ->\r\n    dontPointTo = ['lost-viking', 'kithgard-mastery']  # Challenge levels we don't want most players bashing heads against\r\n    subscriptionPrompts = [{slug: 'boom-and-bust', unless: 'defense-of-plainswood'}]\r\n\r\n    if @campaign?.get('slug') is 'game-dev-hoc'\r\n      # HoC: Just order left-to-right instead of looking at unlocks, which we don't use for this copycat campaign\r\n      orderedLevels = _.sortBy orderedLevels, (level) -> level.position.x\r\n      for level in orderedLevels\r\n        if @levelStatusMap[level.slug] isnt 'complete'\r\n          level.next = true\r\n          # Unlock and re-annotate this level\r\n          # May not be unlocked/awarded due to different game-dev-hoc progression using mostly shared levels\r\n          level.locked = false\r\n          level.hidden = level.locked\r\n          level.disabled = false\r\n          level.color = 'rgb(255, 80, 60)'\r\n          return\r\n\r\n    findNextLevel = (nextLevels, practiceOnly) =>\r\n      for nextLevelOriginal in nextLevels\r\n        nextLevel = _.find orderedLevels, original: nextLevelOriginal\r\n        continue if not nextLevel or nextLevel.locked\r\n        continue if practiceOnly and not @campaign.levelIsPractice(nextLevel)\r\n\r\n        # If it's a challenge level, we efficiently determine whether we actually do want to point it out.\r\n        if nextLevel.slug is 'kithgard-mastery' and not @levelStatusMap[nextLevel.slug] and @calculateExperienceScore() >= 3\r\n          unless (timesPointedOut = storage.load(\"pointed-out-#{nextLevel.slug}\") or 0) > 3\r\n            # We may determineNextLevel more than once per render, so we can't just do this once. But we do give up after a couple highlights.\r\n            dontPointTo = _.without dontPointTo, nextLevel.slug\r\n            storage.save \"pointed-out-#{nextLevel.slug}\", timesPointedOut + 1\r\n\r\n        # Should we point this level out?\r\n        if not nextLevel.disabled and @levelStatusMap[nextLevel.slug] isnt 'complete' and nextLevel.slug not in dontPointTo and\r\n        not nextLevel.replayable and (\r\n          me.isPremium() or not nextLevel.requiresSubscription or nextLevel.adventurer or\r\n          _.any(subscriptionPrompts, (prompt) => nextLevel.slug is prompt.slug and not @levelStatusMap[prompt.unless])\r\n        )\r\n          nextLevel.next = true\r\n          return true\r\n      false\r\n\r\n    foundNext = false\r\n    for level, levelIndex in orderedLevels\r\n      # Iterate through all levels in order and look to find the first unlocked one that meets all our criteria for being pointed out as the next level.\r\n      if @campaign.get('type') is 'course'\r\n        level.nextLevels = []\r\n        for nextLevel, nextLevelIndex in orderedLevels when nextLevelIndex > levelIndex\r\n          continue if nextLevel.practice and level.nextLevels.length\r\n          break if level.practice and not nextLevel.practice\r\n          level.nextLevels.push nextLevel.original\r\n          break unless nextLevel.practice\r\n      else\r\n        level.nextLevels = (reward.level for reward in level.rewards ? [] when reward.level)\r\n      foundNext = findNextLevel(level.nextLevels, true) unless foundNext # Check practice levels first\r\n      foundNext = findNextLevel(level.nextLevels, false) unless foundNext\r\n\r\n    if not foundNext and orderedLevels[0] and not orderedLevels[0].locked and @levelStatusMap[orderedLevels[0].slug] isnt 'complete'\r\n      orderedLevels[0].next = true\r\n\r\n  calculateExperienceScore: ->\r\n    adultPoint = me.get('ageRange') in ['18-24', '25-34', '35-44', '45-100']  # They have to have answered the poll for this, likely after Shadow Guard.\r\n    speedPoints = 0\r\n    for [levelSlug, speedThreshold] in [['dungeons-of-kithgard', 50], ['gems-in-the-deep', 55], ['shadow-guard', 55], ['forgetful-gemsmith', 40], ['true-names', 40]]\r\n      if _.find(@sessions?.models, (session) -> session.get('levelID') is levelSlug)?.attributes.playtime <= speedThreshold\r\n        ++speedPoints\r\n    experienceScore = adultPoint + speedPoints  # 0-6 score of how likely we think they are to be experienced and ready for Kithgard Mastery\r\n    return experienceScore\r\n\r\n  createLines: ->\r\n    for level in @campaign?.renderedLevels ? []\r\n      for nextLevelOriginal in level.nextLevels ? []\r\n        if nextLevel = _.find(@campaign.renderedLevels, original: nextLevelOriginal)\r\n          @createLine level.position, nextLevel.position\r\n\r\n  createLine: (o1, o2) ->\r\n    mapHeight = parseFloat($(\".map\").css(\"height\"))\r\n    mapWidth = parseFloat($(\".map\").css(\"width\"))\r\n    return unless mapHeight > 0\r\n    ratio =  mapWidth / mapHeight\r\n    p1 = x: o1.x, y: o1.y / ratio\r\n    p2 = x: o2.x, y: o2.y / ratio\r\n    length = Math.sqrt(Math.pow(p1.x - p2.x , 2) + Math.pow(p1.y - p2.y, 2))\r\n    angle = Math.atan2(p1.y - p2.y, p2.x - p1.x) * 180 / Math.PI\r\n    transform = \"translateY(-50%) translateX(-50%) rotate(#{angle}deg) translateX(50%)\"\r\n    line = $('<div>').appendTo('.map').addClass('next-level-line').css(transform: transform, width: length + '%', left: o1.x + '%', bottom: (o1.y - 0.5) + '%')\r\n    line.append($('<div class=\"line\">')).append($('<div class=\"point\">'))\r\n\r\n  applyCampaignStyles: ->\r\n    return unless @campaign?.loaded\r\n    if (backgrounds = @campaign.get 'backgroundImage') and backgrounds.length\r\n      backgrounds = _.sortBy backgrounds, 'width'\r\n      backgrounds.reverse()\r\n      rules = []\r\n      for background, i in backgrounds\r\n        rule = \"#campaign-view .map-background { background-image: url(/file/#{background.image}); }\"\r\n        rule = \"@media screen and (max-width: #{background.width}px) { #{rule} }\" if i\r\n        rules.push rule\r\n      utils.injectCSS rules.join('\\n')\r\n    if backgroundColor = @campaign.get 'backgroundColor'\r\n      backgroundColorTransparent = @campaign.get 'backgroundColorTransparent'\r\n      @$el.css 'background-color', backgroundColor\r\n      for pos in ['top', 'right', 'bottom', 'left']\r\n        @$el.find(\".#{pos}-gradient\").css 'background-image', \"linear-gradient(to #{pos}, #{backgroundColorTransparent} 0%, #{backgroundColor} 100%)\"\r\n    @playAmbientSound()\r\n\r\n  testParticles: ->\r\n    return unless @campaign?.loaded and $.browser.chrome  # Sometimes this breaks in non-Chrome browsers, according to A/B tests.\r\n    @particleMan ?= new ParticleMan()\r\n    @particleMan.removeEmitters()\r\n    @particleMan.attach @$el.find('.map')\r\n    for level in @campaign.renderedLevels ? {}\r\n      continue if level.hidden and (@campaign.levelIsPractice(level) or not level.unlockedInSameCampaign)\r\n      terrain = @terrain.replace('-branching-test', '').replace(/(campaign-)?(game|web)-dev-\\d/, 'forest').replace(/(intro|game-dev-hoc)/, 'dungeon')\r\n      particleKey = ['level', terrain]\r\n      particleKey.push level.type if level.type and not (level.type in ['hero', 'course'])  # Would use isType, but it's not a Level model\r\n      particleKey.push 'replayable' if level.replayable\r\n      particleKey.push 'premium' if level.requiresSubscription\r\n      particleKey.push 'gate' if level.slug in ['kithgard-gates', 'siege-of-stonehold', 'clash-of-clones', 'summits-gate']\r\n      particleKey.push 'hero' if level.unlocksHero and not level.unlockedHero\r\n      #particleKey.push 'item' if level.slug is 'robot-ragnarok'  # TODO: generalize\r\n      continue if particleKey.length is 2  # Don't show basic levels\r\n      continue unless level.hidden or _.intersection(particleKey, ['item', 'hero-ladder', 'replayable', 'game-dev']).length\r\n      @particleMan.addEmitter level.position.x / 100, level.position.y / 100, particleKey.join('-')\r\n\r\n  onMouseEnterPortals: (e) ->\r\n    return unless @campaigns?.loaded and @sessions?.loaded\r\n    @portalScrollInterval = setInterval @onMouseMovePortals, 100\r\n    @onMouseMovePortals e\r\n\r\n  onMouseLeavePortals: (e) ->\r\n    return unless @portalScrollInterval\r\n    clearInterval @portalScrollInterval\r\n    @portalScrollInterval = null\r\n\r\n  onMouseMovePortals: (e) =>\r\n    return unless @portalScrollInterval\r\n    $portal = @$el.find('.portal')\r\n    $portals = @$el.find('.portals')\r\n    if e\r\n      @portalOffsetX = Math.round Math.max 0, e.clientX - $portal.offset().left\r\n    bodyWidth = $('body').innerWidth()\r\n    fraction = @portalOffsetX / bodyWidth\r\n    return if 0.2 < fraction < 0.8\r\n    direction = if fraction < 0.5 then 1 else -1\r\n    magnitude = 0.2 * bodyWidth * (if direction is -1 then fraction - 0.8 else 0.2 - fraction) / 0.2\r\n    portalsWidth = 2536  # TODO: if we add campaigns or change margins, this will get out of date...\r\n    scrollTo = $portals.offset().left + direction * magnitude\r\n    scrollTo = Math.max bodyWidth - portalsWidth, scrollTo\r\n    scrollTo = Math.min 0, scrollTo\r\n    $portals.stop().animate {marginLeft: scrollTo}, 100, 'linear'\r\n\r\n  onSessionsLoaded: (e) ->\r\n    return if @editorMode\r\n    for session in @sessions.models\r\n      unless @levelStatusMap[session.get('levelID')] is 'complete'  # Don't overwrite a complete session with an incomplete one\r\n        @levelStatusMap[session.get('levelID')] = if session.get('state')?.complete then 'complete' else 'started'\r\n      @levelDifficultyMap[session.get('levelID')] = session.get('state').difficulty if session.get('state')?.difficulty\r\n    @render()\r\n    @loadUserPollsRecord() unless me.get('anonymous') or window.serverConfig.picoCTF\r\n\r\n  onCampaignsLoaded: (e) ->\r\n    @render()\r\n\r\n  preloadLevel: (levelSlug) ->\r\n    levelURL = \"/db/level/#{levelSlug}\"\r\n    level = new Level().setURL levelURL\r\n    level = @supermodel.loadModel(level, null, 0).model\r\n    sessionURL = \"/db/level/#{levelSlug}/session\"\r\n    @preloadedSession = new LevelSession().setURL sessionURL\r\n    @listenToOnce @preloadedSession, 'sync', @onSessionPreloaded\r\n    @preloadedSession = @supermodel.loadModel(@preloadedSession, {cache: false}).model\r\n    @preloadedSession.levelSlug = levelSlug\r\n\r\n  onSessionPreloaded: (session) ->\r\n    session.url = -> '/db/level.session/' + @id\r\n    levelElement = @$el.find('.level-info-container:visible')\r\n    return unless session.levelSlug is levelElement.data 'level-slug'\r\n    return unless difficulty = session.get('state')?.difficulty\r\n    badge = $(\"<span class='badge'>#{difficulty}</span>\")\r\n    levelElement.find('.start-level .badge').remove()\r\n    levelElement.find('.start-level').append badge\r\n\r\n  onClickMap: (e) ->\r\n    @$levelInfo?.hide()\r\n    if @sessions?.models.length < 3\r\n      # Restore the next level higlight for very new players who might otherwise get lost.\r\n      @highlightElement '.level.next', delay: 500, duration: 60000, rotation: 0, sides: ['top']\r\n\r\n  onClickLevel: (e) ->\r\n    e.preventDefault()\r\n    e.stopPropagation()\r\n    @$levelInfo?.hide()\r\n    levelElement = $(e.target).parents('.level')\r\n    levelSlug = levelElement.data('level-slug')\r\n    levelOriginal = levelElement.data('level-original')\r\n    if @editorMode\r\n      return @trigger 'level-clicked', levelOriginal\r\n    @$levelInfo = @$el.find(\".level-info-container[data-level-slug=#{levelSlug}]\").show()\r\n    @checkForCourseOption levelOriginal\r\n    @adjustLevelInfoPosition e\r\n    @endHighlight()\r\n    @preloadLevel levelSlug\r\n\r\n  onDoubleClickLevel: (e) ->\r\n    return unless @editorMode\r\n    levelElement = $(e.target).parents('.level')\r\n    levelOriginal = levelElement.data('level-original')\r\n    @trigger 'level-double-clicked', levelOriginal\r\n\r\n  onClickStartLevel: (e) ->\r\n    levelElement = $(e.target).parents('.level-info-container')\r\n    levelSlug = levelElement.data('level-slug')\r\n    levelOriginal = levelElement.data('level-original')\r\n    level = _.find _.values(@campaign.get('levels')), slug: levelSlug\r\n\r\n    requiresSubscription = level.requiresSubscription or (me.isOnPremiumServer() and not (level.slug in ['dungeons-of-kithgard', 'gems-in-the-deep', 'shadow-guard', 'forgetful-gemsmith', 'signs-and-portents', 'true-names']))\r\n    canPlayAnyway = not @requiresSubscription or level.adventurer or @levelStatusMap[level.slug]\r\n    if requiresSubscription and not canPlayAnyway\r\n      @promptForSubscription levelSlug, 'map level clicked'\r\n    else\r\n      @startLevel levelElement\r\n      window.tracker?.trackEvent 'Clicked Start Level', category: 'World Map', levelID: levelSlug\r\n\r\n  onClickCourseVersion: (e) ->\r\n    levelSlug = $(e.target).parents('.level-info-container').data 'level-slug'\r\n    courseID = $(e.target).parents('.course-version').data 'course-id'\r\n    courseInstanceID = $(e.target).parents('.course-version').data 'course-instance-id'\r\n    url = \"/play/level/#{levelSlug}?course=#{courseID}&course-instance=#{courseInstanceID}\"\r\n    Backbone.Mediator.publish 'router:navigate', route: url\r\n\r\n  startLevel: (levelElement) ->\r\n    @setupManager?.destroy()\r\n    levelSlug = levelElement.data 'level-slug'\r\n    session = @preloadedSession if @preloadedSession?.loaded and @preloadedSession.levelSlug is levelSlug\r\n    @setupManager = new LevelSetupManager supermodel: @supermodel, levelID: levelSlug, levelPath: levelElement.data('level-path'), levelName: levelElement.data('level-name'), hadEverChosenHero: @hadEverChosenHero, parent: @, session: session\r\n    unless @setupManager?.navigatingToPlay\r\n      @$levelInfo.find('.level-info, .progress').toggleClass('hide')\r\n      @listenToOnce @setupManager, 'open', ->\r\n        @$levelInfo?.find('.level-info, .progress').toggleClass('hide')\r\n        @$levelInfo?.hide()\r\n      @setupManager.open()\r\n\r\n  onClickViewSolutions: (e) ->\r\n    levelElement = $(e.target).parents('.level-info-container')\r\n    levelSlug = levelElement.data('level-slug')\r\n    level = _.find _.values(@campaign.get('levels')), slug: levelSlug\r\n    if level.type in ['hero-ladder', 'course-ladder']  # Would use isType, but it's not a Level model\r\n      Backbone.Mediator.publish 'router:navigate', route: \"/play/ladder/#{levelSlug}\", viewClass: 'views/ladder/LadderView', viewArgs: [{supermodel: @supermodel}, levelSlug]\r\n    else\r\n      @showLeaderboard levelSlug\r\n\r\n  adjustLevelInfoPosition: (e) ->\r\n    return unless @$levelInfo\r\n    @$map ?= @$el.find('.map')\r\n    mapOffset = @$map.offset()\r\n    mapX = e.pageX - mapOffset.left\r\n    mapY = e.pageY - mapOffset.top\r\n    margin = 20\r\n    width = @$levelInfo.outerWidth()\r\n    @$levelInfo.css('left', Math.min(Math.max(margin, mapX - width / 2), @$map.width() - width - margin))\r\n    height = @$levelInfo.outerHeight()\r\n    top = mapY - @$levelInfo.outerHeight() - 60\r\n    if top < 100\r\n      top = mapY + 60\r\n    @$levelInfo.css('top', top)\r\n\r\n  onWindowResize: (e) =>\r\n    mapHeight = iPadHeight = 1536\r\n    mapWidth = {dungeon: 2350, forest: 2500, auditions: 2500, desert: 2350, mountain: 2422, glacier: 2421}[@terrain] or 2350\r\n    aspectRatio = mapWidth / mapHeight\r\n    pageWidth = @$el.width()\r\n    pageHeight = @$el.height()\r\n    pageHeight -= adContainerHeight if adContainerHeight = $('.ad-container').outerHeight()\r\n    widthRatio = pageWidth / mapWidth\r\n    heightRatio = pageHeight / mapHeight\r\n    # Make sure we can see the whole map, fading to background in one dimension.\r\n    if heightRatio <= widthRatio\r\n      # Left and right margin\r\n      resultingHeight = pageHeight\r\n      resultingWidth = resultingHeight * aspectRatio\r\n    else\r\n      # Top and bottom margin\r\n      resultingWidth = pageWidth\r\n      resultingHeight = resultingWidth / aspectRatio\r\n    resultingMarginX = (pageWidth - resultingWidth) / 2\r\n    resultingMarginY = (pageHeight - resultingHeight) / 2\r\n    @$el.find('.map').css(width: resultingWidth, height: resultingHeight, 'margin-left': resultingMarginX, 'margin-top': resultingMarginY)\r\n    @testParticles() if @particleMan\r\n\r\n  playAmbientSound: ->\r\n    return unless me.get 'volume'\r\n    return if @ambientSound\r\n    return unless file = @campaign?.get('ambientSound')?[AudioPlayer.ext.substr 1]\r\n    src = \"/file/#{file}\"\r\n    unless AudioPlayer.getStatus(src)?.loaded\r\n      AudioPlayer.preloadSound src\r\n      Backbone.Mediator.subscribeOnce 'audio-player:loaded', @playAmbientSound, @\r\n      return\r\n    @ambientSound = createjs.Sound.play src, loop: -1, volume: 0.1\r\n    createjs.Tween.get(@ambientSound).to({volume: 0.5}, 1000)\r\n\r\n  playMusic: ->\r\n    @musicPlayer = new MusicPlayer()\r\n    musicFile = '/music/music-menu'\r\n    Backbone.Mediator.publish 'music-player:play-music', play: true, file: musicFile\r\n    storage.save(\"loaded-menu-music\", true) unless @probablyCachedMusic\r\n\r\n  checkForCourseOption: (levelOriginal) ->\r\n    return unless me.get('courseInstances')?.length\r\n    @courseOptionsChecked ?= {}\r\n    return if @courseOptionsChecked[levelOriginal]\r\n    @courseOptionsChecked[levelOriginal] = true\r\n    courseInstances = new CocoCollection [], url: \"/db/course_instance/-/find_by_level/#{levelOriginal}\", model: CourseInstance\r\n    courseInstances.comparator = (ci) -> return -(ci.get('members') ? []).length\r\n    @supermodel.loadCollection courseInstances, 'course_instances'\r\n    @listenToOnce courseInstances, 'sync', =>\r\n      return if @destroyed\r\n      return unless courseInstance = courseInstances.models[0]\r\n      @$el.find(\".course-version[data-level-original='#{levelOriginal}']\").removeClass('hidden').data('course-id': courseInstance.get('courseID'), 'course-instance-id': courseInstance.id)\r\n\r\n  preloadTopHeroes: ->\r\n    return if window.serverConfig.picoCTF\r\n    for heroID in ['captain', 'knight']\r\n      url = \"/db/thang.type/#{ThangType.heroes[heroID]}/version\"\r\n      continue if @supermodel.getModel url\r\n      fullHero = new ThangType()\r\n      fullHero.setURL url\r\n      @supermodel.loadModel fullHero\r\n\r\n  updateVolume: (volume) ->\r\n    volume ?= me.get('volume') ? 1.0\r\n    classes = ['vol-off', 'vol-down', 'vol-up']\r\n    button = $('#volume-button', @$el)\r\n    button.toggleClass 'vol-off', volume <= 0.0\r\n    button.toggleClass 'vol-down', 0.0 < volume < 1.0\r\n    button.toggleClass 'vol-up', volume >= 1.0\r\n    createjs.Sound.setVolume(if volume is 1 then 0.6 else volume)  # Quieter for now until individual sound FX controls work again.\r\n    if volume isnt me.get 'volume'\r\n      me.set 'volume', volume\r\n      me.patch()\r\n      @playAmbientSound() if volume\r\n\r\n  onToggleVolume: (e) ->\r\n    button = $(e.target).closest('#volume-button')\r\n    classes = ['vol-off', 'vol-down', 'vol-up']\r\n    volumes = [0, 0.4, 1.0]\r\n    for oldClass, i in classes\r\n      if button.hasClass oldClass\r\n        newI = (i + 1) % classes.length\r\n        break\r\n      else if i is classes.length - 1  # no oldClass\r\n        newI = 2\r\n    @updateVolume volumes[newI]\r\n\r\n  onClickBack: (e) ->\r\n    Backbone.Mediator.publish 'router:navigate',\r\n      route: \"/play\"\r\n      viewClass: CampaignView\r\n      viewArgs: [{supermodel: @supermodel}]\r\n\r\n  onClickClearStorage: (e) ->\r\n    localStorage.clear()\r\n    noty {\r\n      text: 'Local storage cleared. Reload to view the original campaign.'\r\n      layout: 'topCenter'\r\n      timeout: 5000\r\n      type: 'information'\r\n    }\r\n\r\n  updateHero: ->\r\n    return unless hero = me.get('heroConfig')?.thangType\r\n    for slug, original of ThangType.heroes when original is hero\r\n      @$el.find('.player-hero-icon').removeClass().addClass('player-hero-icon ' + slug)\r\n      return\r\n    console.error \"CampaignView hero update couldn't find hero slug for original:\", hero\r\n\r\n  onClickPortalCampaign: (e) ->\r\n    campaign = $(e.target).closest('.campaign, .beta-campaign')\r\n    return if campaign.is('.locked') or campaign.is('.silhouette')\r\n    campaignSlug = campaign.data('campaign-slug')\r\n    if @isPremiumCampaign(campaignSlug) and not me.isPremium()\r\n      return @promptForSubscription campaignSlug, 'premium campaign clicked'\r\n    Backbone.Mediator.publish 'router:navigate',\r\n      route: \"/play/#{campaignSlug}\"\r\n      viewClass: CampaignView\r\n      viewArgs: [{supermodel: @supermodel}, campaignSlug]\r\n\r\n  onClickCampaignSwitch: (e) ->\r\n    campaignSlug = $(e.target).data('campaign-slug')\r\n    console.log campaignSlug, @isPremiumCampaign campaignSlug\r\n    if @isPremiumCampaign(campaignSlug) and not me.isPremium()\r\n      e.preventDefault()\r\n      e.stopImmediatePropagation()\r\n      return @promptForSubscription campaignSlug, 'premium campaign switch clicked'\r\n\r\n  loadUserPollsRecord: ->\r\n    url = \"/db/user.polls.record/-/user/#{me.id}\"\r\n    @userPollsRecord = new UserPollsRecord().setURL url\r\n    onRecordSync = ->\r\n      return if @destroyed\r\n      @userPollsRecord.url = -> '/db/user.polls.record/' + @id\r\n      lastVoted = new Date(@userPollsRecord.get('changed') or 0)\r\n      interval = new Date() - lastVoted\r\n      if interval > 22 * 60 * 60 * 1000  # Wait almost a day before showing the next poll\r\n        @loadPoll()\r\n      else\r\n        console.log 'Poll will be ready in', (22 * 60 * 60 * 1000 - interval) / (60 * 60 * 1000), 'hours.'\r\n    @listenToOnce @userPollsRecord, 'sync', onRecordSync\r\n    @userPollsRecord = @supermodel.loadModel(@userPollsRecord, null, 0).model\r\n    onRecordSync.call @ if @userPollsRecord.loaded\r\n\r\n  loadPoll: ->\r\n    url = \"/db/poll/#{@userPollsRecord.id}/next\"\r\n    @poll = new Poll().setURL url\r\n    onPollSync = ->\r\n      return if @destroyed\r\n      @poll.url = -> '/db/poll/' + @id\r\n      _.delay (=> @activatePoll?()), 1000\r\n    onPollError = (poll, response, request) ->\r\n      if response.status is 404\r\n        console.log 'There are no more polls left.'\r\n      else\r\n        console.error \"Couldn't load poll:\", response.status, response.statusText\r\n      delete @poll\r\n    @listenToOnce @poll, 'sync', onPollSync\r\n    @listenToOnce @poll, 'error', onPollError\r\n    @poll = @supermodel.loadModel(@poll, null, 0).model\r\n    onPollSync.call @ if @poll.loaded\r\n\r\n  activatePoll: ->\r\n    pollTitle = utils.i18n @poll.attributes, 'name'\r\n    $pollButton = @$el.find('button.poll').removeClass('hidden').addClass('highlighted').attr(title: pollTitle).addClass('has-tooltip').tooltip title: pollTitle\r\n    if me.get('lastLevel') is 'shadow-guard'\r\n      @showPoll()\r\n    else\r\n      $pollButton.tooltip 'show'\r\n\r\n  showPoll: ->\r\n    pollModal = new PollModal supermodel: @supermodel, poll: @poll, userPollsRecord: @userPollsRecord\r\n    @openModalView pollModal\r\n    $pollButton = @$el.find 'button.poll'\r\n    pollModal.on 'vote-updated', ->\r\n      $pollButton.removeClass('highlighted').tooltip 'hide'\r\n"]}